# AWS Client VPN 雙環境管理工具套件概述

<!-- markdownlint-disable MD051 -->

## 目錄

1. [概述](#概述)
2. [雙環境架構](#雙環境架構)
3. [環境管理簡介](#環境管理簡介)
4. [系統要求](#系統要求)
5. [工具介紹](#工具介紹)
6. [診斷和修復工具](#診斷和修復工具)
7. [安全最佳實踐](#安全最佳實踐)
8. [詳細文檔](#詳細文檔)

---

## 概述

AWS Client VPN 雙環境管理工具套件是一個專為 macOS 設計的企業級模組化自動化解決方案，核心目標是高效管理 AWS Client VPN 連接以及團隊成員在 **Staging** 和 **Production** 兩種獨立環境中的訪問權限。本套件採用函式庫架構設計，強調環境隔離、安全管理及操作便捷性，旨在為企業提供一個可靠且易於擴展的 VPN 管理框架。

透過雙環境設計，企業能夠在 Staging 環境中安全地進行測試、開發和配置驗證，而 Production 環境則保持穩定運行，服務於正式的業務需求。這種分離確保了生產系統的穩定性，同時為新功能和變更提供了安全的測試平台。

**主要優勢:**
- **環境隔離:** Staging 和 Production 環境完全分離，降低風險。
- **安全強化:** Production 環境操作具備增強的安全確認機制。
- **高效管理:** 提供自動化工具簡化 VPN 端點、用戶權限和證書的管理。
- **模組化設計:** 函式庫易於維護、擴展和客製化。

---

## 雙環境架構

### 🏗️ 環境結構概覽

本工具套件支援完全分離的雙環境架構，確保開發測試與生產操作的獨立性。關鍵資源如配置文件、證書和日誌均按環境存放：

```bash
configs/
├── staging/                 # 🟡 Staging 環境配置
│   └── staging.env
└── production/             # 🔴 Production 環境配置
    └── production.env

certs/
├── staging/                # Staging 環境證書
└── production/             # Production 環境證書

logs/
├── staging/                # Staging 環境日誌
└── production/             # Production 環境日誌
```bash

### 🎯 環境特性

#### Staging 環境 🟡

- **用途**: 主要用於開發、功能測試、配置實驗和模擬。允許開發和 QA 團隊在一個安全的沙箱環境中工作，而不影響生產系統。
- **安全級別**: 標準安全措施，操作確認流程相對簡化。
- **適用對象**: 開發團隊、QA 團隊、需要進行 VPN 配置測試的工程師。

#### Production 環境 🔴

- **用途**: 用於支持實際業務運營的正式生產環境。所有配置和操作都應謹慎處理，以確保服務的穩定性和安全性。
- **安全級別**: 最高安全級別，所有關鍵操作均需要多重確認和嚴格的權限驗證。
- **適用對象**: 運維團隊、負責生產系統維護的資深工程師、以及需要訪問生產資源的授權用戶。

### 🔄 環境切換機制概述

工具套件提供便捷的命令列工具（如 `vpn_env.sh`）來查看當前環境狀態和在不同環境間切換。切換到 Production 環境時，系統會要求額外確認，以防止誤操作。詳細的切換指令和操作指南請參閱 `vpn_connection_manual.md`。

---

## 環境管理簡介

本工具套件提供 `vpn_env.sh` 作為環境管理的主要入口點。它允許用戶進行核心的環境操作，如：

- **查看當前環境狀態**：顯示目前啟用的環境 (Staging 或 Production) 及其基本健康狀況。
- **切換環境**：允許用戶在 Staging 和 Production 環境之間進行切換。切換至 Production 環境時會有額外的安全確認步驟。
- **環境健康檢查**：提供對各個環境健康狀況的快速檢查。

詳細的環境管理操作、指令範例及 `enhanced_env_selector.sh`（增強環境選擇器）的使用方法，請參閱 `vpn_connection_manual.md`。

---

## 系統要求

### 硬體要求

- macOS 10.15+ (Catalina 或更新版本)
- 至少 4GB RAM
- 2GB 可用磁碟空間
- 穩定的網路連接

### 軟體依賴

本套件在首次運行時會嘗試自動安裝必要的依賴工具，包括：

- **Homebrew** - macOS 套件管理器
- **AWS CLI** - AWS 命令列工具
- **jq** - JSON 處理工具
- **Easy-RSA** - 證書管理工具
- **OpenSSL** - 加密工具

### AWS 權限要求

運行本工具套件中的不同腳本需要特定的 AWS IAM 權限。管理員、團隊成員以及執行特殊操作（如員工離職處理）所需的權限各不相同。

- **管理員權限**: 需要管理 Client VPN 端點、ACM 證書、日誌、VPC 和子網路等資源的權限。
- **團隊成員權限**: 需要描述 VPN 端點、導出客戶端配置、以及管理個人 ACM 證書的權限。
- **高權限操作**: 某些特定工具（如 `employee_offboarding.sh`）可能需要更廣泛的權限，例如 IAM 管理、S3 存取等。

詳細的 IAM 權限 JSON 政策範本，請參閱 `vpn_connection_manual.md` 中的初始設置或附錄章節。

---

## 工具介紹

本套件包含一系列腳本工具，以支持雙環境 VPN 的管理：

1.  **`vpn_env.sh`** - 環境管理入口工具。用於切換和查看 Staging/Production 環境狀態，以及執行環境健康檢查。
2.  **`enhanced_env_selector.sh`** - 增強型互動式環境選擇器。提供一個控制台界面，方便用戶進行環境切換、狀態查看和比較等操作。
3.  **`aws_vpn_admin.sh`** - 管理員主控台。核心管理工具，用於創建、查看、管理和刪除 VPN 端點，以及管理團隊設定等。此工具會根據當前選定的環境（Staging/Production）執行操作。
4.  **`team_member_setup.sh`** - 團隊成員設置工具。引導團隊成員完成 VPN 客戶端的配置，包括生成個人證書和 VPN 設定檔。
5.  **`revoke_member_access.sh`** - 權限撤銷工具。用於安全地撤銷特定用戶的 VPN 訪問權限，包括註銷其證書和斷開現有連接。
6.  **`employee_offboarding.sh`** - 員工離職處理系統。提供一個標準化流程，用於處理員工離職時的 VPN 訪問權限移除及相關安全審計。

每個工具的詳細使用方法、參數說明和操作流程，請參閱 `vpn_connection_manual.md`。

---

## 診斷和修復工具

### 故障排除工具

在 `admin/tools/` 目錄中提供了專門的診斷和修復工具：

#### 🔍 診斷工具 (`debug_vpn_creation.sh`)
- **用途**: 全面診斷 VPN 端點創建問題
- **功能**: 檢查 AWS 配置、網路資源、證書狀態、JSON 格式
- **適用場景**: VPN 創建失敗、AWS CLI 錯誤代碼 254

#### 🔧 修復工具 (`fix_vpn_config.sh`)  
- **用途**: 自動修復常見配置問題
- **功能**: 修復 subnet 配置、證書替換、資源衝突清理
- **適用場景**: 配置過期、資源衝突、環境遷移

```bash
# 診斷 VPN 創建問題
./admin/tools/debug_vpn_creation.sh

# 自動修復配置問題
./admin/tools/fix_vpn_config.sh
```

詳細說明請參考: [`admin/tools/README.md`](admin/tools/README.md)

---

## 安全最佳實踐

管理雙環境 AWS Client VPN 時，應遵循以下安全最佳實踐，以保護您的基礎設施和數據：

1.  **最小權限原則 (Principle of Least Privilege)**:
    *   為管理員和用戶分配僅執行其任務所必需的最小 IAM 權限。
    *   定期審查和更新 IAM 政策，移除不再需要的權限。
    *   針對 Staging 和 Production 環境使用不同的 IAM 角色或政策，以實現更細緻的權限控制。

2.  **證書安全管理**:
    *   安全地存儲和處理 CA 證書及私鑰，尤其是 Production 環境的證書。
    *   實施證書輪換策略，定期更新伺服器和客戶端證書。
    *   使用強密碼保護私鑰，並限制對私鑰的訪問。

3.  **強身份驗證**:
    *   考慮為 AWS Client VPN 啟用多因素認證 (MFA) 以增強安全性。
    *   確保團隊成員使用強大且唯一的密碼來保護其本地系統和 VPN 憑證。

4.  **環境隔離與確認**:
    *   嚴格分離 Staging 和 Production 環境的配置、證書和日誌。
    *   在對 Production 環境進行任何更改之前，務必進行多重確認，並尽可能先在 Staging 環境中測試。

5.  **監控與審計**:
    *   啟用並定期審查 AWS CloudTrail 日誌和 VPN 連接日誌。
    *   針對可疑活動或安全事件設置 CloudWatch 警報。
    *   記錄所有管理操作，特別是針對 Production 環境的操作。

6.  **配置文件安全**:
    *   保護本地存儲的 `.ovpn` 配置文件和任何包含敏感信息的腳本配置。
    *   確保敏感文件具有嚴格的文件權限 (例如 `chmod 600`)。

7.  **定期安全審查**:
    *   定期對 VPN 設置、IAM 權限、安全組規則和網路配置進行安全審查。
    *   及時更新和修補 VPN 客戶端軟件及相關依賴項。

詳細的安全配置指南和操作步驟，請參閱 `vpn_connection_manual.md`。

---

## 詳細文檔

本 `readme.md` 文件提供了 AWS Client VPN 雙環境管理工具套件的高級概述。

有關**初始設置、詳細的工具使用指南、具體的操作步驟、環境管理詳情、故障排除、維護流程、AWS 資源管理、移除指南以及附錄內容（如完整的 IAM 政策範例和配置文件結構）**，請參閱配套的完整使用說明書：

📄 `vpn_connection_manual.md`

此說明書將為您提供成功部署、管理和維護雙環境 VPN 解決方案所需的所有詳細信息。

---

**最後更新：** YYYY年MM月DD日
**文檔版本：** 2.1 (表示此為 readme 的新版本)
**適用工具版本：** 2.0
**架構：** 模組化函式庫設計
