# AWS Client VPN ç®¡ç†å·¥å…·å¥—ä»¶å®Œæ•´ä½¿ç”¨èªªæ˜æ›¸

## ç›®éŒ„
1. [æ¦‚è¿°](#æ¦‚è¿°)
2. [ç³»çµ±è¦æ±‚](#ç³»çµ±è¦æ±‚)
3. [åˆå§‹è¨­ç½®](#åˆå§‹è¨­ç½®)
4. [æª”æ¡ˆç³»çµ±å½±éŸ¿](#æª”æ¡ˆç³»çµ±å½±éŸ¿)
5. [å·¥å…·ä»‹ç´¹](#å·¥å…·ä»‹ç´¹)
6. [è©³ç´°ä½¿ç”¨æŒ‡å—](#è©³ç´°ä½¿ç”¨æŒ‡å—)
7. [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
8. [å®‰å…¨æœ€ä½³å¯¦è¸](#å®‰å…¨æœ€ä½³å¯¦è¸)
9. [å¸¸è¦‹å•é¡Œ](#å¸¸è¦‹å•é¡Œ)
10. [ç¶­è­·å’Œç›£æ§](#ç¶­è­·å’Œç›£æ§)
11. [å®Œæ•´ç§»é™¤æŒ‡å—](#å®Œæ•´ç§»é™¤æŒ‡å—)
12. [é™„éŒ„](#é™„éŒ„)

---

## æ¦‚è¿°

AWS Client VPN ç®¡ç†å·¥å…·å¥—ä»¶æ˜¯ä¸€å€‹å°ˆç‚º macOS è¨­è¨ˆçš„è‡ªå‹•åŒ–è§£æ±ºæ–¹æ¡ˆï¼Œç”¨æ–¼ç®¡ç† AWS Client VPN é€£æ¥å’Œåœ˜éšŠæˆå“¡çš„è¨ªå•æ¬Šé™ã€‚æœ¬å¥—ä»¶åŒ…å«å››å€‹æ ¸å¿ƒè…³æœ¬ï¼š

### å·¥å…·çµ„ä»¶
1. **aws_vpn_admin.sh** - ç®¡ç†å“¡ä¸»æ§å°
2. **team_member_setup.sh** - åœ˜éšŠæˆå“¡è¨­ç½®å·¥å…·
3. **revoke_member_access.sh** - æ¬Šé™æ’¤éŠ·å·¥å…·
4. **employee_offboarding.sh** - é›¢è·è™•ç†ç³»çµ±

### ä¸»è¦åŠŸèƒ½
- è‡ªå‹•å»ºç«‹å’Œç®¡ç† AWS Client VPN ç«¯é»
- ç‚ºåœ˜éšŠæˆå“¡ç”Ÿæˆå’Œç®¡ç†å€‹äºº VPN è­‰æ›¸
- å®‰å…¨æ’¤éŠ·è¨ªå•æ¬Šé™
- å…¨é¢çš„é›¢è·å®‰å…¨è™•ç†
- è©³ç´°çš„å¯©è¨ˆæ—¥èªŒå’Œå ±å‘Š

---

## ç³»çµ±è¦æ±‚

### ç¡¬é«”è¦æ±‚
- macOS 10.15+ (Catalina æˆ–æ›´æ–°ç‰ˆæœ¬)
- è‡³å°‘ 4GB RAM
- 2GB å¯ç”¨ç£ç¢Ÿç©ºé–“
- ç©©å®šçš„ç¶²è·¯é€£æ¥

### è»Ÿé«”ä¾è³´
æœ¬å¥—ä»¶æœƒè‡ªå‹•å®‰è£ä»¥ä¸‹å·¥å…·ï¼Œä½†æ‚¨ä¹Ÿå¯ä»¥æ‰‹å‹•é å…ˆå®‰è£ï¼š

- **Homebrew** - macOS å¥—ä»¶ç®¡ç†å™¨
- **AWS CLI** - AWS å‘½ä»¤åˆ—å·¥å…·
- **jq** - JSON è™•ç†å·¥å…·
- **Easy-RSA** - è­‰æ›¸ç®¡ç†å·¥å…·
- **OpenSSL** - åŠ å¯†å·¥å…·
- **curl** - æ•¸æ“šå‚³è¼¸å·¥å…·

### AWS æ¬Šé™è¦æ±‚

#### ç®¡ç†å“¡æ¬Šé™
ä½¿ç”¨ç®¡ç†å“¡è…³æœ¬éœ€è¦ä»¥ä¸‹ AWS æ¬Šé™ï¼š
```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "ec2:*ClientVpn*",
                "acm:*",
                "logs:*",
                "iam:*", 
                "sts:GetCallerIdentity",
                "s3:ListAllMyBuckets",
                "cloudtrail:LookupEvents",
                "cloudtrail:DescribeTrails"
            ],
            "Resource": "*"
        },
        {
            "Sid": "SpecificHighPrivilegeScripts",
            "Effect": "Allow",
            "Action": [
                "iam:DeleteUser",
                "iam:DeleteAccessKey",
                "iam:RemoveUserFromGroup",
                "iam:DetachUserPolicy",
                "iam:DeleteLoginProfile",
                "acm:DeleteCertificate"
            ],
            "Resource": "*"
        }
    ]
}
```
**æ³¨æ„ï¼š** `employee_offboarding.sh` è…³æœ¬åŸ·è¡Œçš„æ“ä½œç¯„åœå¾ˆå»£ï¼Œå¯èƒ½éœ€è¦éå¸¸é«˜çš„ AWS æ¬Šé™ã€‚åŸ·è¡Œæ­¤è…³æœ¬çš„ IAM ä½¿ç”¨è€…/è§’è‰²æ‡‰è¢«åš´æ ¼æ§åˆ¶ï¼Œä¸¦åƒ…æˆäºˆåŸ·è¡Œå…¶ä»»å‹™æ‰€å¿…éœ€çš„æœ€å°æ¬Šé™ã€‚

#### åœ˜éšŠæˆå“¡æ¬Šé™
åœ˜éšŠæˆå“¡ (`team_member_setup.sh` çš„åŸ·è¡Œè€…) éœ€è¦ä»¥ä¸‹æœ€å°æ¬Šé™ï¼š
```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "ec2:DescribeClientVpnEndpoints",
                "ec2:ExportClientVpnClientConfiguration",
                "acm:ImportCertificate",
                "acm:ListCertificates",
                "acm:AddTagsToCertificate"
            ],
            "Resource": "*"
        }
    ]
}
```

---

## åˆå§‹è¨­ç½®

### 1. ä¸‹è¼‰å’Œæº–å‚™

1. **ä¸‹è¼‰å·¥å…·å¥—ä»¶**
   ```bash
   # å‰µå»ºå·¥ä½œç›®éŒ„
   mkdir -p ~/aws-vpn-tools
   cd ~/aws-vpn-tools
   
   # ä¸‹è¼‰æ‰€æœ‰è…³æœ¬æ–‡ä»¶åˆ°æ­¤ç›®éŒ„
   ```

2. **è¨­ç½®åŸ·è¡Œæ¬Šé™**
   ```bash
   chmod +x *.sh
   ```

3. **é©—è­‰æª”æ¡ˆå®Œæ•´æ€§**
   ```bash
   ls -la *.sh
   ```
   æ‡‰è©²çœ‹åˆ°ä»¥ä¸‹æª”æ¡ˆï¼š
   - aws_vpn_admin.sh
   - team_member_setup.sh
   - revoke_member_access.sh
   - employee_offboarding.sh

### 2. AWS é…ç½®

1. **ç²å– AWS è¨ªå•é‡‘é‘°**
   - ç™»å…¥ AWS æ§åˆ¶å°
   - å‰å¾€ IAM > ç”¨æˆ¶ > å®‰å…¨æ†‘è­‰
   - å»ºç«‹æ–°çš„è¨ªå•é‡‘é‘°

2. **é…ç½® AWS CLI**
   ```bash
   aws configure
   ```
   è¼¸å…¥ï¼š
   - AWS Access Key ID
   - AWS Secret Access Key
   - Default region (ä¾‹å¦‚ï¼šap-northeast-1)
   - Default output format: json

3. **é©—è­‰é…ç½®**
   ```bash
   aws sts get-caller-identity
   ```

### 3. ç¶²è·¯æº–å‚™

ç¢ºä¿æ‚¨æœ‰ä»¥ä¸‹è³‡è¨Šï¼š
- ç›®æ¨™ VPC ID
- å­ç¶²è·¯ ID (ç§æœ‰å­ç¶²è·¯)
- VPC CIDR ç¯„åœ
- è¨ˆåŠƒçš„ VPN CIDR ç¯„åœ (ä¸å¯èˆ‡ VPC è¡çª)

---

## æª”æ¡ˆç³»çµ±å½±éŸ¿

### ğŸ“ åŸ·è¡Œå¾Œçš„æœ¬åœ°ç«¯è®Šæ›´ç¸½è¦½

æœ¬å·¥å…·å¥—ä»¶æœƒåœ¨æ‚¨çš„æœ¬åœ°ç³»çµ±å‰µå»ºå¤šå€‹æª”æ¡ˆå’Œç›®éŒ„ã€‚äº†è§£é€™äº›è®Šæ›´æœ‰åŠ©æ–¼æ‚¨ï¼š
- ç®¡ç†æ•æ„Ÿæª”æ¡ˆçš„å®‰å…¨æ€§
- é€²è¡Œç³»çµ±å‚™ä»½å’Œæ¢å¾©
- åœ¨éœ€è¦æ™‚å®Œå…¨ç§»é™¤å·¥å…·

### ğŸ”§ **aws_vpn_admin.sh çš„æª”æ¡ˆå½±éŸ¿**

#### å‰µå»ºçš„ç›®éŒ„çµæ§‹ï¼š
```
å°ˆæ¡ˆæ ¹ç›®éŒ„/
â”œâ”€â”€ .vpn_config                    # âš ï¸ ä¸»é…ç½®æª”æ¡ˆ (æ•æ„Ÿ)
â”œâ”€â”€ vpn_admin.log                  # æ“ä½œæ—¥èªŒ
â”œâ”€â”€ lib/                          # å‡½å¼åº«ç›®éŒ„
â”‚   â””â”€â”€ *.log                     # å„ç¨®åº«å‡½å¼æ—¥èªŒ
â”œâ”€â”€ certificates/                  # ğŸ”’ è­‰æ›¸ç›®éŒ„ (é«˜åº¦æ•æ„Ÿ)
â”‚   â””â”€â”€ pki/
â”‚       â”œâ”€â”€ ca.crt                # CA è­‰æ›¸
â”‚       â”œâ”€â”€ private/
â”‚       â”‚   â”œâ”€â”€ ca.key            # ğŸ” CA ç§é‘° (æ¥µåº¦æ•æ„Ÿ)
â”‚       â”‚   â”œâ”€â”€ server.key        # ğŸ” ä¼ºæœå™¨ç§é‘°
â”‚       â”‚   â””â”€â”€ admin.key         # ğŸ” ç®¡ç†å“¡ç§é‘°
â”‚       â””â”€â”€ issued/
â”‚           â”œâ”€â”€ server.crt        # ä¼ºæœå™¨è­‰æ›¸
â”‚           â””â”€â”€ admin.crt         # ç®¡ç†å“¡è­‰æ›¸
â”œâ”€â”€ configs/                       # ç®¡ç†å“¡ VPN é…ç½®
â”‚   â”œâ”€â”€ admin-config-base.ovpn    # åŸºç¤é…ç½®
â”‚   â””â”€â”€ admin-config.ovpn         # ğŸ”’ å®Œæ•´é…ç½® (å«ç§é‘°)
â””â”€â”€ team-configs/                  # åœ˜éšŠåˆ†ç™¼æª”æ¡ˆ
    â”œâ”€â”€ team-config-base.ovpn     # åŸºç¤é…ç½®
    â”œâ”€â”€ ca.crt                    # CA è­‰æ›¸å‰¯æœ¬
    â”œâ”€â”€ ca.key                    # ğŸ” CA ç§é‘°å‰¯æœ¬
    â””â”€â”€ team-setup-info.txt       # è¨­ç½®è³‡è¨Š
```

#### è‡ªå‹•å®‰è£çš„è»Ÿé«”å·¥å…·ï¼š
```bash
# é€é Homebrew å®‰è£ï¼š
/opt/homebrew/bin/brew            # Homebrew (Apple Silicon)
/usr/local/bin/brew               # Homebrew (Intel Mac)
â”œâ”€â”€ aws                          # AWS CLI
â”œâ”€â”€ jq                           # JSON è™•ç†å™¨
â””â”€â”€ easyrsa                      # è­‰æ›¸ç®¡ç†å·¥å…·
```

### ğŸ‘¥ **team_member_setup.sh çš„æª”æ¡ˆå½±éŸ¿**

#### AWS é…ç½®è®Šæ›´ï¼š
```bash
~/.aws/
â”œâ”€â”€ credentials                   # ğŸ” AWS èªè­‰è³‡è¨Š (æ¥µåº¦æ•æ„Ÿ)
â””â”€â”€ config                       # AWS é…ç½®è¨­å®š
```

#### æœ¬åœ°æª”æ¡ˆå‰µå»ºï¼š
```
å°ˆæ¡ˆç›®éŒ„/
â”œâ”€â”€ .user_vpn_config             # âš ï¸ ç”¨æˆ¶é…ç½® (æ•æ„Ÿ)
â”œâ”€â”€ user_vpn_setup.log           # ç”¨æˆ¶è¨­ç½®æ—¥èªŒ
â”œâ”€â”€ user-certificates/           # ğŸ”’ ç”¨æˆ¶è­‰æ›¸ç›®éŒ„ (é«˜åº¦æ•æ„Ÿ)
â”‚   â”œâ”€â”€ ca.crt                  # CA è­‰æ›¸
â”‚   â”œâ”€â”€ [username].crt          # ç”¨æˆ¶è­‰æ›¸
â”‚   â””â”€â”€ [username].key          # ğŸ” ç”¨æˆ¶ç§é‘° (æ¥µåº¦æ•æ„Ÿ)
â””â”€â”€ vpn-config/                 # VPN é…ç½®æª”æ¡ˆ
    â”œâ”€â”€ client-config-base.ovpn # åŸºç¤é…ç½®
    â””â”€â”€ [username]-config.ovpn  # ğŸ”’ å€‹äºº VPN é…ç½® (å«ç§é‘°)
```

#### ç³»çµ±æ‡‰ç”¨ç¨‹å¼å®‰è£ï¼š
```bash
/Applications/AWS VPN Client.app  # AWS VPN å®¢æˆ¶ç«¯æ‡‰ç”¨ç¨‹å¼
~/Downloads/AWS_VPN_Client.pkg    # å®‰è£åŒ…æª”æ¡ˆ (å¯åˆªé™¤)
```

### ğŸš« **revoke_member_access.sh çš„æª”æ¡ˆå½±éŸ¿**

#### å‰µå»ºçš„æ—¥èªŒæª”æ¡ˆï¼š
```
å°ˆæ¡ˆç›®éŒ„/
â””â”€â”€ revocation-logs/              # æ’¤éŠ·æ—¥èªŒç›®éŒ„
    â”œâ”€â”€ revocation.log           # æ’¤éŠ·æ“ä½œæ—¥èªŒ
    â””â”€â”€ [username]_revocation_[timestamp].log  # ğŸ“‹ å€‹åˆ¥æ’¤éŠ·å ±å‘Š
```

**æ³¨æ„ï¼š** æ­¤è…³æœ¬åƒ…å‰µå»ºæ—¥èªŒæª”æ¡ˆï¼Œä¸å®‰è£è»Ÿé«”æˆ–ä¿®æ”¹ç³»çµ±é…ç½®ã€‚

### ğŸ¢ **employee_offboarding.sh çš„æª”æ¡ˆå½±éŸ¿**

#### å‰µå»ºçš„å¯©è¨ˆæª”æ¡ˆï¼š
```
å°ˆæ¡ˆç›®éŒ„/
â””â”€â”€ offboarding-logs/                           # é›¢è·è™•ç†æ—¥èªŒç›®éŒ„
    â”œâ”€â”€ offboarding.log                        # ä¸»è¦é›¢è·æ—¥èªŒ
    â”œâ”€â”€ security_report_[employee]_[timestamp].txt      # ğŸ“‹ å®‰å…¨å ±å‘Š
    â”œâ”€â”€ offboarding_checklist_[employee]_[timestamp].txt # ğŸ“‹ æª¢æŸ¥æ¸…å–®
    â””â”€â”€ audit-[employee_id]-[date]/            # å¯©è¨ˆè³‡æ–™ç›®éŒ„
        â”œâ”€â”€ audit_summary.txt                 # å¯©è¨ˆæ‘˜è¦
        â”œâ”€â”€ cloudtrail_events.json           # CloudTrail äº‹ä»¶è¨˜éŒ„
        â””â”€â”€ vpn_events_*.json                # VPN äº‹ä»¶æ—¥èªŒ
```

### âš™ï¸ **ç³»çµ±è¨­å®šè®Šæ›´**

#### Homebrew ç’°å¢ƒè®Šæ›´ï¼š
```bash
# é¦–æ¬¡å®‰è£ Homebrew æ™‚çš„è®Šæ›´ï¼š
/opt/homebrew/                   # Apple Silicon Mac å®‰è£ä½ç½®
/usr/local/                      # Intel Mac å®‰è£ä½ç½®

# Shell é…ç½®æª”æ¡ˆå¯èƒ½çš„è®Šæ›´ï¼š
~/.zshrc                        # å¯èƒ½æ·»åŠ  Homebrew PATH
~/.bash_profile                 # å¯èƒ½æ·»åŠ  Homebrew PATH
```

#### ç¶²è·¯é…ç½®å½±éŸ¿ï¼š
```bash
# å®‰è£ AWS VPN Client å¾Œï¼š
# - ç³»çµ±åå¥½è¨­å®šä¸­æœƒå‡ºç¾ VPN é€£æ¥é¸é …
# - é€£æ¥æ™‚æœƒæš«æ™‚ä¿®æ”¹ç¶²è·¯è·¯ç”±è¡¨
# - å¯èƒ½å½±éŸ¿ DNS è¨­å®š (é€£æ¥æœŸé–“)
```

### ğŸ”’ **æª”æ¡ˆæ¬Šé™å’Œå®‰å…¨è¨­å®š**

æ‰€æœ‰æ•æ„Ÿæª”æ¡ˆæœƒè‡ªå‹•è¨­ç½®é©ç•¶æ¬Šé™ï¼š

```bash
# é…ç½®æª”æ¡ˆæ¬Šé™ (åƒ…æ‰€æœ‰è€…å¯è®€å¯«)
chmod 600 .vpn_config
chmod 600 .user_vpn_config
chmod 600 ~/.aws/credentials

# è­‰æ›¸å’Œç§é‘°æ¬Šé™ (åƒ…æ‰€æœ‰è€…å¯è®€å¯«)
chmod 600 certificates/pki/private/*.key
chmod 600 user-certificates/*.key
chmod 600 *.ovpn                          # VPN é…ç½®å«ç§é‘°

# ç›®éŒ„æ¬Šé™ (åƒ…æ‰€æœ‰è€…å¯å­˜å–)
chmod 700 certificates/
chmod 700 user-certificates/
chmod 700 revocation-logs/
chmod 700 offboarding-logs/

# æ—¥èªŒæª”æ¡ˆæ¬Šé™
chmod 600 *.log
chmod 600 *-logs/*.txt
```

### ğŸ“Š **ç£ç¢Ÿç©ºé–“ä½¿ç”¨ä¼°ç®—**

```bash
è­‰æ›¸æª”æ¡ˆï¼š              ~5MB
æ—¥èªŒæª”æ¡ˆï¼š              ~50MB (å–æ±ºæ–¼ä½¿ç”¨é‡)
VPN é…ç½®æª”æ¡ˆï¼š          ~1MB
è»Ÿé«”å·¥å…·ï¼š
  â”œâ”€â”€ Homebrewï¼š        ~500MB
  â”œâ”€â”€ AWS CLIï¼š         ~200MB
  â”œâ”€â”€ jqï¼š             ~5MB
  â”œâ”€â”€ Easy-RSAï¼š       ~10MB
  â””â”€â”€ AWS VPN Clientï¼š  ~100MB

ç¸½è¨ˆä¼°ç®—ï¼š              ~871MB
```

### âš ï¸ **é‡è¦å®‰å…¨æé†’**

#### ğŸ” æ¥µåº¦æ•æ„Ÿæª”æ¡ˆ (éœ€ç‰¹åˆ¥ä¿è­·)ï¼š
- `certificates/pki/private/ca.key` - CA ç§é‘°
- `user-certificates/*.key` - ç”¨æˆ¶ç§é‘°
- `~/.aws/credentials` - AWS èªè­‰è³‡è¨Š
- `*.ovpn` - å«ç§é‘°çš„ VPN é…ç½®æª”æ¡ˆ

#### ğŸ“‹ æ•æ„Ÿæª”æ¡ˆ (éœ€é©ç•¶ä¿è­·)ï¼š
- `.vpn_config` - VPN ç«¯é»é…ç½®
- `.user_vpn_config` - ç”¨æˆ¶é…ç½®
- `certificates/pki/ca.crt` - CA è­‰æ›¸

#### ğŸ’¡ å®‰å…¨å»ºè­°ï¼š
1. **å®šæœŸå‚™ä»½**ï¼šå°‡æ•æ„Ÿæª”æ¡ˆå‚™ä»½åˆ°åŠ å¯†å„²å­˜è£ç½®
2. **å­˜å–æ§åˆ¶**ï¼šç¢ºä¿æª”æ¡ˆæ¬Šé™è¨­å®šæ­£ç¢º (å·²è‡ªå‹•è¨­å®š)
3. **å®šæœŸè¼ªæ›**ï¼šå®šæœŸæ›´æ–°è­‰æ›¸å’Œ AWS èªè­‰
4. **å®‰å…¨åˆªé™¤**ï¼šç§»é™¤æª”æ¡ˆæ™‚ä½¿ç”¨å®‰å…¨åˆªé™¤æ–¹æ³•

---

## AWS é›²ç«¯è³‡æºå½±éŸ¿

### â˜ï¸ åŸ·è¡Œå¾Œçš„AWSè®Šæ›´ç¸½è¦½

æœ¬å·¥å…·å¥—ä»¶æœƒåœ¨æ‚¨çš„AWSå¸³æˆ¶ä¸­å‰µå»ºã€ä¿®æ”¹æˆ–åˆªé™¤å¤šç¨®AWSè³‡æºã€‚äº†è§£é€™äº›è®Šæ›´æœ‰åŠ©æ–¼æ‚¨ï¼š
- ç®¡ç†AWSæˆæœ¬å’Œè³‡æºé…é¡
- é€²è¡Œå®‰å…¨å¯©è¨ˆå’Œåˆè¦æª¢æŸ¥
- è¦åŠƒç½é›£æ¢å¾©å’Œå‚™ä»½ç­–ç•¥
- åœ¨éœ€è¦æ™‚å®Œå…¨æ¸…ç†AWSè³‡æº

### ğŸ”§ **aws_vpn_admin.sh çš„AWSè³‡æºå½±éŸ¿**

#### å‰µå»ºçš„æ ¸å¿ƒAWSæœå‹™ï¼š

##### 1. **AWS Certificate Manager (ACM) è­‰æ›¸**
```bash
# ä¼ºæœå™¨è­‰æ›¸
è³‡æºARN: arn:aws:acm:region:account:certificate/[server-cert-id]
ç”¨é€”: VPNç«¯é»çš„ä¼ºæœå™¨èº«ä»½é©—è­‰
æ¨™ç±¤:
  - Name: "VPN-Server-Cert"
  - Purpose: "ClientVPN"
  - ManagedBy: "nlInc-vpnMgmtTools"

# å®¢æˆ¶ç«¯CAè­‰æ›¸  
è³‡æºARN: arn:aws:acm:region:account:certificate/[client-ca-cert-id]
ç”¨é€”: å®¢æˆ¶ç«¯è­‰æ›¸é©—è­‰çš„æ ¹CA
æ¨™ç±¤: åŒä¸Šï¼ŒNameç‚º"VPN-Client-CA"
```

##### 2. **EC2 Client VPN ç«¯é»**
```bash
# ä¸»è¦VPNç«¯é»
è³‡æºID: cvpn-endpoint-[random-id]
é…ç½®:
  - ClientCidrBlock: 172.16.0.0/22 (é è¨­ï¼Œå¯è‡ªå®š)
  - ServerCertificateArn: [ä¼ºæœå™¨è­‰æ›¸ARN]
  - èªè­‰æ–¹å¼: ç›¸äº’TLSè­‰æ›¸èªè­‰
  - åˆ†å‰²é€šé“: å•Ÿç”¨
  - DNSä¼ºæœå™¨: 8.8.8.8, 8.8.4.4
  - é€£æ¥æ—¥èªŒ: å•Ÿç”¨
æ¨™ç±¤:
  - Name: [ç”¨æˆ¶æŒ‡å®šçš„VPNåç¨±]
  - Purpose: "ProductionDebug"
```

##### 3. **CloudWatch Logs æ—¥èªŒç¾¤çµ„**
```bash
# VPNé€£æ¥æ—¥èªŒ
æ—¥èªŒç¾¤çµ„åç¨±: /aws/clientvpn/[VPN_NAME]
ä¿ç•™æ”¿ç­–: æ°¸ä¹…ä¿ç•™ (é™¤éæ‰‹å‹•è¨­å®š)
ç”¨é€”: è¨˜éŒ„æ‰€æœ‰VPNé€£æ¥æ´»å‹•
```

##### 4. **VPN ç¶²è·¯é—œè¯**
```bash
# æ¯å€‹é—œè¯çš„å­ç¶²è·¯ä¸€å€‹
é—œè¯ID: cvpn-assoc-[random-id]
é—œè¯ç›®æ¨™:
  - ä¸»è¦VPCå­ç¶²è·¯: subnet-[primary-id]
  - é¡å¤–VPCå­ç¶²è·¯: subnet-[additional-ids] (å¦‚æœé…ç½®)
ç‹€æ…‹: "associated"
```

##### 5. **VPN æˆæ¬Šè¦å‰‡**
```bash
# ä¸»è¦VPCè¨ªå•æˆæ¬Š
ç›®æ¨™ç¶²è·¯: [ä¸»è¦VPCçš„CIDRç¯„åœ]
æˆæ¬Šå°è±¡: æ‰€æœ‰ç¾¤çµ„ (AllowAllGroups)
ç‹€æ…‹: "active"

# é¡å¤–VPCæˆæ¬Š (å¦‚æœé…ç½®å¤šVPC)
ç›®æ¨™ç¶²è·¯: [é¡å¤–VPCçš„CIDRç¯„åœ]
æˆæ¬Šå°è±¡: æ‰€æœ‰ç¾¤çµ„
```

##### 6. **VPN è·¯ç”±è¡¨**
```bash
# é è¨­ç¶²éš›ç¶²è·¯è·¯ç”±
ç›®æ¨™CIDR: 0.0.0.0/0
ç›®æ¨™å­ç¶²è·¯: subnet-[primary-id]
ä¾†æº: "add-route"

# VPCç‰¹å®šè·¯ç”± (å¦‚æœéœ€è¦)
ç›®æ¨™CIDR: [VPC_CIDRç¯„åœ]
ç›®æ¨™å­ç¶²è·¯: subnet-[target-id]
```

### ğŸ‘¥ **team_member_setup.sh çš„AWSè³‡æºå½±éŸ¿**

#### å‰µå»ºçš„AWSè³‡æºï¼š

##### 1. **å€‹äººå®¢æˆ¶ç«¯ACMè­‰æ›¸**
```bash
# æ¯å€‹åœ˜éšŠæˆå“¡ä¸€å€‹è­‰æ›¸
è³‡æºARN: arn:aws:acm:region:account:certificate/[user-cert-id]
è­‰æ›¸å…§å®¹:
  - å®¢æˆ¶ç«¯è­‰æ›¸: [ç”¨æˆ¶çš„.crtæª”æ¡ˆ]
  - ç§é‘°: [ç”¨æˆ¶çš„.keyæª”æ¡ˆ]
  - è­‰æ›¸éˆ: [CAè­‰æ›¸]
æ¨™ç±¤:
  - Name: "VPN-Client-[USERNAME]"
  - Purpose: "ClientVPN"
  - User: "[USERNAME]"
  - CreatedBy: "[åŸ·è¡Œè€…]"
```

#### æŸ¥è©¢çš„AWSæœå‹™ (ç„¡ä¿®æ”¹)ï¼š
- **EC2 Client VPN**: é©—è­‰ç«¯é»å­˜åœ¨å’Œç‹€æ…‹
- **EC2 Client VPN**: ä¸‹è¼‰å®¢æˆ¶ç«¯é…ç½®ç¯„æœ¬

### ğŸš« **revoke_member_access.sh çš„AWSè³‡æºå½±éŸ¿**

#### åˆªé™¤/ä¿®æ”¹çš„AWSè³‡æºï¼š

##### 1. **ACMè­‰æ›¸æ“ä½œ**
```bash
# å„ªå…ˆæ“ä½œï¼šåˆªé™¤è­‰æ›¸
aws acm delete-certificate --certificate-arn [user-cert-arn]

# å‚™ç”¨æ“ä½œï¼šæ¨™è¨˜ç‚ºå·²æ’¤éŠ· (å¦‚æœåˆªé™¤å¤±æ•—)
æ–°å¢æ¨™ç±¤:
  - Status: "Revoked"
  - RevokedBy: "[æ“ä½œè€…ç”¨æˆ¶å]"
  - RevokedDate: "[ISOæ™‚é–“æˆ³]"
  - Reason: "[æ’¤éŠ·åŸå› ]"
```

##### 2. **VPNé€£æ¥ç®¡ç†**
```bash
# å¼·åˆ¶æ–·é–‹ç”¨æˆ¶é€£æ¥
æ“ä½œ: terminate-client-vpn-connections
ç›®æ¨™: æ‰€æœ‰åŒ¹é…ç”¨æˆ¶IDçš„æ´»èºé€£æ¥
æ•ˆæœ: ç«‹å³æ–·é–‹ï¼Œç”¨æˆ¶ç„¡æ³•é‡æ–°é€£æ¥
```

##### 3. **IAMç”¨æˆ¶è™•ç†** (å¯é¸ï¼Œéœ€è¦æ¬Šé™)
```bash
# è¨ªå•å¯†é‘°ç®¡ç†
1. åœç”¨æ‰€æœ‰è¨ªå•å¯†é‘° (Status: Inactive)
2. åˆªé™¤æ‰€æœ‰è¨ªå•å¯†é‘°

# æ”¿ç­–å’Œæ¬Šé™æ¸…ç†
1. åˆ†é›¢æ‰€æœ‰é™„åŠ çš„ç®¡ç†æ”¿ç­–
2. åˆªé™¤æ‰€æœ‰å…§åµŒæ”¿ç­–
3. å¾æ‰€æœ‰IAMç¾¤çµ„ç§»é™¤ç”¨æˆ¶

# å¸³æˆ¶æ¸…ç†
1. åˆªé™¤ç™»å…¥è¨­å®šæª”
2. åœç”¨æ‰€æœ‰MFAè¨­å‚™
3. æœ€çµ‚åˆªé™¤IAMç”¨æˆ¶ (å¦‚æœé¸æ“‡)
```

### ğŸ¢ **employee_offboarding.sh çš„AWSè³‡æºå½±éŸ¿**

#### æœ€å»£æ³›çš„AWSæ“ä½œ (é«˜æ¬Šé™è¦æ±‚)ï¼š

##### 1. **ç·Šæ€¥å®‰å…¨æªæ–½**
```bash
# å…¨åŸŸVPNé€£æ¥æƒæå’Œçµ‚æ­¢
æ“ä½œç¯„åœ: æ‰€æœ‰Client VPNç«¯é»
æœç´¢æ¢ä»¶: åŒ…å«å“¡å·¥IDçš„é€£æ¥
åŸ·è¡Œå‹•ä½œ: ç«‹å³çµ‚æ­¢æ‰€æœ‰åŒ¹é…çš„é€£æ¥
å½±éŸ¿: å¯èƒ½å½±éŸ¿å¤šå€‹VPNç«¯é»çš„é€£æ¥
```

##### 2. **å…¨é¢è­‰æ›¸æ’¤éŠ·**
```bash
# æ‰¹é‡è­‰æ›¸æœç´¢å’Œè™•ç†
æœç´¢æ–¹å¼:
  - åŸŸååŒ¹é… (DomainNameåŒ…å«å“¡å·¥ä¿¡æ¯)
  - æ¨™ç±¤åŒ¹é… (Name/Useræ¨™ç±¤åŒ…å«å“¡å·¥ä¿¡æ¯)
è™•ç†å‹•ä½œ:
  - åˆªé™¤æ‰€æœ‰åŒ¹é…çš„ACMè­‰æ›¸
  - ç‚ºç„¡æ³•åˆªé™¤çš„è­‰æ›¸æ·»åŠ æ’¤éŠ·æ¨™è¨˜
```

##### 3. **å®Œæ•´IAMæ¸…ç†**
```bash
# å¾¹åº•çš„èº«ä»½å’Œè¨ªå•ç®¡ç†æ¸…ç†
ç«‹å³æ“ä½œ:
  - åœç”¨æ‰€æœ‰è¨ªå•å¯†é‘°
  - åˆ†é›¢æ‰€æœ‰æ”¿ç­– (ç®¡ç†å’Œå…§åµŒ)
  - å¾æ‰€æœ‰IAMç¾¤çµ„ç§»é™¤
  - åˆªé™¤ç™»å…¥è¨­å®šæª”å’ŒMFAè¨­å‚™
æœ€çµ‚æ“ä½œ:
  - å®Œå…¨åˆªé™¤IAMç”¨æˆ¶å¸³æˆ¶
```

##### 4. **è³‡æºå¯©è¨ˆå’Œæƒæ**
```bash
# S3å­˜å„²æ¡¶å¯©è¨ˆ
æƒæç¯„åœ: å¸³æˆ¶å…§æ‰€æœ‰S3å­˜å„²æ¡¶
æœç´¢æ¢ä»¶: å­˜å„²æ¡¶åç¨±åŒ…å«å“¡å·¥ä¿¡æ¯
å ±å‘Šå…§å®¹: æ½›åœ¨çš„å“¡å·¥ç›¸é—œè³‡æº

# EC2å¯¦ä¾‹å¯©è¨ˆ
æœç´¢æ¢ä»¶: Owneræ¨™ç±¤åŒ¹é…å“¡å·¥ä¿¡æ¯
ç‹€æ…‹æª¢æŸ¥: running, stoppedå¯¦ä¾‹
å ±å‘Šå…§å®¹: éœ€è¦äººå·¥æª¢æŸ¥çš„å¯¦ä¾‹æ¸…å–®

# æ®˜ç•™è­‰æ›¸æª¢æŸ¥
æƒæç¯„åœ: ç•¶å‰å€åŸŸçš„æ‰€æœ‰ACMè­‰æ›¸
æª¢æŸ¥å…§å®¹: åŸŸåå’Œæ¨™ç±¤ä¸­çš„å“¡å·¥ä¿¡æ¯
```

##### 5. **å¯©è¨ˆæ—¥èªŒæ”¶é›†**
```bash
# CloudTrailäº‹ä»¶æŸ¥è©¢
æ™‚é–“ç¯„åœ: æœ€è¿‘30å¤©
éæ¿¾æ¢ä»¶: å“¡å·¥ç›¸é—œçš„APIèª¿ç”¨
è¼¸å‡ºæ ¼å¼: JSONæ ¼å¼çš„äº‹ä»¶è¨˜éŒ„

# VPNé€£æ¥æ—¥èªŒåˆ†æ
æ•¸æ“šä¾†æº: æ‰€æœ‰VPNç«¯é»çš„CloudWatchæ—¥èªŒ
åˆ†æå…§å®¹: å“¡å·¥çš„é€£æ¥æ¨¡å¼å’Œæ™‚é–“
çµ±è¨ˆè³‡æ–™: é€£æ¥æ¬¡æ•¸ã€æŒçºŒæ™‚é–“ã€æ™‚é–“åˆ†ä½ˆ
```

---

## ğŸ’° AWSæˆæœ¬å½±éŸ¿åˆ†æ

### æ–°å¢çš„è¨ˆè²»è³‡æºï¼š

#### 1. **Client VPNç«¯é»è²»ç”¨**
```bash
è¨ˆè²»çµæ§‹:
â”œâ”€â”€ ç«¯é»è²»ç”¨: $0.10/å°æ™‚ (24/7é‹è¡Œ)
â”œâ”€â”€ é€£æ¥è²»ç”¨: $0.05/å°æ™‚/æ¯å€‹æ´»èºé€£æ¥
â””â”€â”€ æ•¸æ“šå‚³è¼¸: æ¨™æº–AWSå‡ºç«™æ•¸æ“šå‚³è¼¸è²»ç‡

æœˆè²»ç”¨ä¼°ç®— (å–®ä¸€ç«¯é»):
â”œâ”€â”€ åŸºç¤ç«¯é»è²»ç”¨: ~$72/æœˆ
â”œâ”€â”€ 10å€‹ç”¨æˆ¶é€£æ¥: ~$360/æœˆ (å‡è¨­æ¯å¤©8å°æ™‚ä½¿ç”¨)
â”œâ”€â”€ æ•¸æ“šå‚³è¼¸è²»ç”¨: ä¾å¯¦éš›ä½¿ç”¨é‡è¨ˆç®—
â””â”€â”€ ç¸½è¨ˆä¼°ç®—: $432-500/æœˆ (ä¸å«æ•¸æ“šå‚³è¼¸)
```

#### 2. **CloudWatch Logsè²»ç”¨**
```bash
è¨ˆè²»é …ç›®:
â”œâ”€â”€ æ—¥èªŒæ”å–: $0.50/GB
â”œâ”€â”€ æ—¥èªŒå„²å­˜: $0.03/GB/æœˆ  
â””â”€â”€ æ—¥èªŒæŸ¥è©¢: $0.005/GBæƒæçš„æ•¸æ“š

æœˆè²»ç”¨ä¼°ç®—:
â”œâ”€â”€ æ¯ç”¨æˆ¶æ—¥èªŒé‡: ~100MB/æœˆ
â”œâ”€â”€ 10å€‹ç”¨æˆ¶: ~$0.50æ”å– + $0.03å„²å­˜
â””â”€â”€ ç¸½è¨ˆä¼°ç®—: ~$1-5/æœˆ
```

#### 3. **ACMè­‰æ›¸è²»ç”¨**
```bash
è­‰æ›¸é¡å‹å’Œè²»ç”¨:
â”œâ”€â”€ å…¬æœ‰SSL/TLSè­‰æ›¸: å…è²»
â”œâ”€â”€ ç§æœ‰è­‰æ›¸ (å¦‚ä½¿ç”¨ACM Private CA): $400/æœˆèµ·
â””â”€â”€ è‡ªç°½è­‰æ›¸ (æœ¬å·¥å…·ä½¿ç”¨): å…è²»

ç¸½è¨ˆ: $0 (ä½¿ç”¨è‡ªç°½è­‰æ›¸)
```

#### 4. **ç¸½é«”æœˆè²»ç”¨ä¼°ç®—**
```bash
å°å‹éƒ¨ç½² (5ç”¨æˆ¶):
â”œâ”€â”€ VPNç«¯é»å’Œé€£æ¥: ~$250/æœˆ
â”œâ”€â”€ CloudWatchæ—¥èªŒ: ~$2/æœˆ
â”œâ”€â”€ è­‰æ›¸è²»ç”¨: $0
â””â”€â”€ ç¸½è¨ˆ: ~$252/æœˆ

ä¸­å‹éƒ¨ç½² (20ç”¨æˆ¶):  
â”œâ”€â”€ VPNç«¯é»å’Œé€£æ¥: ~$900/æœˆ
â”œâ”€â”€ CloudWatchæ—¥èªŒ: ~$8/æœˆ
â”œâ”€â”€ è­‰æ›¸è²»ç”¨: $0
â””â”€â”€ ç¸½è¨ˆ: ~$908/æœˆ
```

### æˆæœ¬å„ªåŒ–å»ºè­°ï¼š
- å®šæœŸæª¢æŸ¥æœªä½¿ç”¨çš„VPNé€£æ¥
- è¨­å®šCloudWatchæ—¥èªŒçš„ä¿ç•™æœŸé™
- ç›£æ§æ•¸æ“šå‚³è¼¸ä½¿ç”¨é‡
- è€ƒæ…®åœ¨éå·¥ä½œæ™‚é–“æš«åœVPNç«¯é» (å¦‚æœé©ç”¨)

---

## ğŸ” AWSå®‰å…¨å’Œåˆè¦è€ƒé‡

### é«˜é¢¨éšªAWSæ“ä½œæ¸…å–®ï¼š

#### 1. **IAMæ¬Šé™è¦æ±‚**
```json
{
  "é«˜é¢¨éšªæ“ä½œ": {
    "iam:DeleteUser": "å®Œå…¨åˆªé™¤IAMç”¨æˆ¶",
    "iam:DeleteAccessKey": "åˆªé™¤ç”¨æˆ¶è¨ªå•é‡‘é‘°", 
    "acm:DeleteCertificate": "åˆªé™¤SSL/TLSè­‰æ›¸",
    "ec2:TerminateClientVpnConnections": "å¼·åˆ¶æ–·é–‹VPNé€£æ¥",
    "logs:DeleteLogGroup": "åˆªé™¤æ—¥èªŒç¾¤çµ„"
  },
  "å®‰å…¨å»ºè­°": [
    "ä½¿ç”¨æœ€å°æ¬Šé™åŸå‰‡",
    "å•Ÿç”¨å¤šå› ç´ èªè­‰ (MFA)",
    "å®šæœŸè¼ªæ›è¨ªå•é‡‘é‘°",
    "ç›£æ§AWS CloudTrailæ—¥èªŒ"
  ]
}
```

#### 2. **è³‡æºæ¨™ç±¤æ²»ç†**
```bash
# æ‰€æœ‰å‰µå»ºçš„è³‡æºéƒ½åŒ…å«ä¸€è‡´çš„æ¨™ç±¤
æ¨™æº–æ¨™ç±¤é›†:
â”œâ”€â”€ Purpose: "ClientVPN"
â”œâ”€â”€ ManagedBy: "nlInc-vpnMgmtTools"
â”œâ”€â”€ Environment: "Production" | "Staging" | "Development"
â”œâ”€â”€ Owner: "[å‰µå»ºè€…IAMèº«ä»½]"
â”œâ”€â”€ CreatedDate: "[ISOæ™‚é–“æˆ³]"
â””â”€â”€ Project: "[å°ˆæ¡ˆä»£ç¢¼]"

å¥½è™•:
â”œâ”€â”€ æˆæœ¬åˆ†é…å’Œè¿½è¹¤
â”œâ”€â”€ è³‡æºç”Ÿå‘½é€±æœŸç®¡ç†
â”œâ”€â”€ å®‰å…¨å¯©è¨ˆå’Œåˆè¦
â””â”€â”€ è‡ªå‹•åŒ–æ¸…ç†æ”¿ç­–
```

#### 3. **å¯©è¨ˆè¿½è¹¤**
```bash
# CloudTrailè¨˜éŒ„çš„é—œéµäº‹ä»¶
VPNç®¡ç†äº‹ä»¶:
â”œâ”€â”€ CreateClientVpnEndpoint
â”œâ”€â”€ DeleteClientVpnEndpoint
â”œâ”€â”€ AssociateClientVpnTargetNetwork
â”œâ”€â”€ DisassociateClientVpnTargetNetwork
â”œâ”€â”€ AuthorizeClientVpnIngress
â””â”€â”€ RevokeClientVpnIngress

è­‰æ›¸ç®¡ç†äº‹ä»¶:
â”œâ”€â”€ ImportCertificate
â”œâ”€â”€ DeleteCertificate
â”œâ”€â”€ AddTagsToCertificate
â””â”€â”€ ListCertificates

IAMç®¡ç†äº‹ä»¶:
â”œâ”€â”€ DeleteUser
â”œâ”€â”€ DeleteAccessKey
â”œâ”€â”€ DetachUserPolicy
â””â”€â”€ RemoveUserFromGroup
```

#### 4. **åˆè¦è€ƒé‡**
```bash
# æ•¸æ“šä¿è­·æ³•è¦
GDPRåˆè¦:
â”œâ”€â”€ ç”¨æˆ¶æ•¸æ“šçš„è™•ç†è¨˜éŒ„
â”œâ”€â”€ æ•¸æ“šåˆªé™¤æ¬Š (è¢«éºå¿˜æ¬Š)
â”œâ”€â”€ æ•¸æ“šå¯æ”œæ€§
â””â”€â”€ é•è¦é€šçŸ¥ç¾©å‹™

SOC 2åˆè¦:
â”œâ”€â”€ è¨ªå•æ§åˆ¶ (è­‰æ›¸ç®¡ç†)
â”œâ”€â”€ ç›£æ§å’Œæ—¥èªŒè¨˜éŒ„
â”œâ”€â”€ è®Šæ›´ç®¡ç†æµç¨‹
â””â”€â”€ äº‹ä»¶éŸ¿æ‡‰ç¨‹åº

ISO 27001åˆè¦:
â”œâ”€â”€ è³‡è¨Šå®‰å…¨ç®¡ç†
â”œâ”€â”€ é¢¨éšªè©•ä¼°å’Œç®¡ç†
â”œâ”€â”€ è¨ªå•æ¬Šé™ç®¡ç†
â””â”€â”€ æŒçºŒæ”¹é€²
```

---

## ğŸ—ºï¸ AWSå€åŸŸå’Œå¯ç”¨æ€§å½±éŸ¿

### å€åŸŸç¶å®šè³‡æºï¼š

#### 1. **å€åŸŸç‰¹å®šæœå‹™**
```bash
# ä»¥ä¸‹è³‡æºèˆ‡ç‰¹å®šAWSå€åŸŸç¶å®š
å¿…é ˆåœ¨åŒä¸€å€åŸŸ:
â”œâ”€â”€ Client VPNç«¯é»
â”œâ”€â”€ ACMè­‰æ›¸
â”œâ”€â”€ CloudWatchæ—¥èªŒç¾¤çµ„
â”œâ”€â”€ VPCå’Œå­ç¶²è·¯
â”œâ”€â”€ ç›®æ¨™EC2å¯¦ä¾‹
â””â”€â”€ å®‰å…¨ç¾¤çµ„

è·¨å€åŸŸé™åˆ¶:
â”œâ”€â”€ è­‰æ›¸ç„¡æ³•è·¨å€åŸŸä½¿ç”¨
â”œâ”€â”€ VPNç«¯é»ç„¡æ³•é—œè¯å…¶ä»–å€åŸŸçš„VPC
â”œâ”€â”€ æ—¥èªŒåˆ†æ•£åœ¨ä¸åŒå€åŸŸ
â””â”€â”€ ç½é›£æ¢å¾©éœ€è¦æ¯å€‹å€åŸŸç¨ç«‹éƒ¨ç½²
```

#### 2. **å¤šå€åŸŸéƒ¨ç½²ç­–ç•¥**
```bash
# å»ºè­°çš„å¤šå€åŸŸæ¶æ§‹
ä¸»è¦å€åŸŸ (ap-northeast-1):
â”œâ”€â”€ ä¸»è¦VPNç«¯é»
â”œâ”€â”€ ç”Ÿç”¢ç’°å¢ƒVPCé—œè¯
â”œâ”€â”€ ä¸»è¦ç”¨æˆ¶ç¾¤çµ„
â””â”€â”€ å®Œæ•´è­‰æ›¸ç®¡ç†

ç½é›£æ¢å¾©å€åŸŸ (ap-southeast-1):
â”œâ”€â”€ å‚™ç”¨VPNç«¯é» (é å…ˆé…ç½®)
â”œâ”€â”€ ç›¸åŒçš„è­‰æ›¸å‚™ä»½
â”œâ”€â”€ ç¶²è·¯é…ç½®é¡åƒ
â””â”€â”€ è‡ªå‹•åŒ–æ•…éšœè½‰ç§»è…³æœ¬

å¥½è™•:
â”œâ”€â”€ æé«˜å¯ç”¨æ€§å’Œå®¹éŒ¯æ€§
â”œâ”€â”€ æ›´å¥½çš„ä½¿ç”¨è€…é«”é©— (å»¶é²å„ªåŒ–)
â”œâ”€â”€ åˆè¦è¦æ±‚ (æ•¸æ“šæœ¬åœ°åŒ–)
â””â”€â”€ è² è¼‰åˆ†æ•£
```

---

## ğŸ§¹ AWSè³‡æºå®Œæ•´æ¸…ç†æŒ‡å—

### æ¸…ç†AWSè³‡æºçš„é †åºï¼š

#### 1. **æº–å‚™éšæ®µ**
```bash
# è¨˜éŒ„ç¾æœ‰è³‡æº
aws ec2 describe-client-vpn-endpoints --region [region]
aws acm list-certificates --region [region]
aws logs describe-log-groups --log-group-name-prefix "/aws/clientvpn"

# å°å‡ºé‡è¦é…ç½® (å‚™ä»½ç”¨)
aws ec2 export-client-vpn-client-configuration \
  --client-vpn-endpoint-id [endpoint-id] \
  --region [region] > backup-config.ovpn
```

#### 2. **æ–·é–‹æ‰€æœ‰é€£æ¥**
```bash
# å„ªé›…æ–·é–‹æ‰€æœ‰VPNé€£æ¥
aws ec2 describe-client-vpn-connections \
  --client-vpn-endpoint-id [endpoint-id] \
  --region [region]

aws ec2 terminate-client-vpn-connections \
  --client-vpn-endpoint-id [endpoint-id] \
  --connection-ids [connection-id-list] \
  --region [region]
```

#### 3. **ç§»é™¤æˆæ¬Šå’Œè·¯ç”±**
```bash
# åˆªé™¤æ‰€æœ‰æˆæ¬Šè¦å‰‡
aws ec2 describe-client-vpn-authorization-rules \
  --client-vpn-endpoint-id [endpoint-id] --region [region]

aws ec2 revoke-client-vpn-ingress \
  --client-vpn-endpoint-id [endpoint-id] \
  --target-network-cidr [cidr] \
  --revoke-all-groups --region [region]

# åˆªé™¤æ‰€æœ‰è·¯ç”±
aws ec2 describe-client-vpn-routes \
  --client-vpn-endpoint-id [endpoint-id] --region [region]

aws ec2 delete-client-vpn-route \
  --client-vpn-endpoint-id [endpoint-id] \
  --destination-cidr-block [cidr] \
  --target-vpc-subnet-id [subnet-id] \
  --region [region]
```

#### 4. **è§£é™¤ç¶²è·¯é—œè¯**
```bash
# è§£é™¤æ‰€æœ‰å­ç¶²è·¯é—œè¯
aws ec2 describe-client-vpn-target-networks \
  --client-vpn-endpoint-id [endpoint-id] --region [region]

aws ec2 disassociate-client-vpn-target-network \
  --client-vpn-endpoint-id [endpoint-id] \
  --association-id [association-id] \
  --region [region]

# ç­‰å¾…è§£é™¤é—œè¯å®Œæˆ
aws ec2 wait client-vpn-target-network-disassociated \
  --client-vpn-endpoint-id [endpoint-id] \
  --association-ids [association-id] \
  --region [region]
```

#### 5. **åˆªé™¤VPNç«¯é»**
```bash
# åˆªé™¤VPNç«¯é»
aws ec2 delete-client-vpn-endpoint \
  --client-vpn-endpoint-id [endpoint-id] \
  --region [region]

# ç­‰å¾…åˆªé™¤å®Œæˆ
aws ec2 wait client-vpn-endpoint-deleted \
  --client-vpn-endpoint-ids [endpoint-id] \
  --region [region]
```

#### 6. **æ¸…ç†è­‰æ›¸å’Œæ—¥èªŒ**
```bash
# åˆªé™¤ACMè­‰æ›¸
aws acm delete-certificate \
  --certificate-arn [certificate-arn] \
  --region [region]

# åˆªé™¤CloudWatchæ—¥èªŒç¾¤çµ„
aws logs delete-log-group \
  --log-group-name "/aws/clientvpn/[vpn-name]" \
  --region [region]
```

#### 7. **é©—è­‰æ¸…ç†å®Œæ•´æ€§**
```bash
# ç¢ºèªæ‰€æœ‰è³‡æºå·²æ¸…ç†
aws ec2 describe-client-vpn-endpoints --region [region]
aws acm list-certificates --region [region] | grep VPN
aws logs describe-log-groups --log-group-name-prefix "/aws/clientvpn"

# æª¢æŸ¥ç›¸é—œè²»ç”¨
aws ce get-cost-and-usage \
  --time-period Start=2024-01-01,End=2024-01-31 \
  --granularity MONTHLY \
  --metrics BlendedCost \
  --group-by Type=DIMENSION,Key=SERVICE
```

---

## ğŸ“Š AWSè³‡æºç›£æ§å’Œè­¦å ±

### å»ºè­°çš„CloudWatchè­¦å ±ï¼š

#### 1. **æˆæœ¬ç›£æ§**
```bash
# VPNç«¯é»æˆæœ¬è­¦å ±
aws cloudwatch put-metric-alarm \
  --alarm-name "VPN-Cost-Alert" \
  --alarm-description "VPN monthly cost exceeds threshold" \
  --metric-name EstimatedCharges \
  --namespace AWS/Billing \
  --statistic Maximum \
  --period 86400 \
  --threshold 500 \
  --comparison-operator GreaterThanThreshold
```

#### 2. **é€£æ¥ç›£æ§**
```bash
# ç•°å¸¸é€£æ¥æ•¸è­¦å ±
aws cloudwatch put-metric-alarm \
  --alarm-name "VPN-Connection-Spike" \
  --alarm-description "Unusual number of VPN connections" \
  --metric-name ActiveConnections \
  --namespace AWS/ClientVPN \
  --statistic Sum \
  --period 300 \
  --threshold 50 \
  --comparison-operator GreaterThanThreshold
```

#### 3. **å®‰å…¨ç›£æ§**
```bash
# è­‰æ›¸å³å°‡éæœŸè­¦å ±
aws cloudwatch put-metric-alarm \
  --alarm-name "Certificate-Expiry-Warning" \
  --alarm-description "SSL certificate expiring soon" \
  --metric-name DaysToExpiry \
  --namespace AWS/CertificateManager \
  --statistic Minimum \
  --period 86400 \
  --threshold 30 \
  --comparison-operator LessThanThreshold
```

---

## å·¥å…·ä»‹ç´¹

### aws_vpn_admin.sh - ç®¡ç†å“¡ä¸»æ§å°

**ç”¨é€”ï¼š** VPN åŸºç¤è¨­æ–½çš„å»ºç«‹ã€ç®¡ç†å’Œç¶­è­·

**ä¸»è¦åŠŸèƒ½ï¼š**
- å»ºç«‹æ–°çš„ VPN ç«¯é»
- ç®¡ç†ç¾æœ‰ç«¯é»è¨­å®š
- æŸ¥çœ‹é€£æ¥æ—¥èªŒ
- åŒ¯å‡ºåœ˜éšŠè¨­å®š
- ç³»çµ±å¥åº·æª¢æŸ¥
- åˆªé™¤ VPN ç«¯é»

**é©ç”¨å°è±¡ï¼š** IT ç®¡ç†å“¡ã€DevOps å·¥ç¨‹å¸«

### team_member_setup.sh - åœ˜éšŠæˆå“¡è¨­ç½®å·¥å…·

**ç”¨é€”ï¼š** ç‚ºæ–°åœ˜éšŠæˆå“¡è¨­ç½® VPN è¨ªå•

**ä¸»è¦åŠŸèƒ½ï¼š**
- ç”Ÿæˆå€‹äººå®¢æˆ¶ç«¯è­‰æ›¸
- å°å…¥è­‰æ›¸åˆ° AWS ACM
- ä¸‹è¼‰å’Œé…ç½® VPN å®¢æˆ¶ç«¯
- å»ºç«‹å€‹äººé…ç½®æª”æ¡ˆ

**é©ç”¨å°è±¡ï¼š** æ–°åŠ å…¥çš„åœ˜éšŠæˆå“¡
**ä½œæ¥­ç³»çµ±ç›¸å®¹æ€§ï¼š** æ­¤è…³æœ¬ä¸­çš„ AWS VPN Client è»Ÿé«”ä¸‹è¼‰å’Œå®‰è£æ­¥é©Ÿç›®å‰ä¸»è¦é‡å° macOS (.pkg)ã€‚å…¶ä»–ä½œæ¥­ç³»çµ±çš„ä½¿ç”¨è€…å¯èƒ½éœ€è¦æ‰‹å‹•ä¸‹è¼‰ä¸¦å®‰è£é©ç”¨å…¶ç³»çµ±çš„ AWS VPN Clientï¼Œæˆ–è‡ªè¡Œèª¿æ•´è…³æœ¬ä¸­çš„ç›¸é—œå®‰è£æŒ‡ä»¤ã€‚

### revoke_member_access.sh - æ¬Šé™æ’¤éŠ·å·¥å…·

**ç”¨é€”ï¼š** æ’¤éŠ·ç‰¹å®šæˆå“¡çš„ VPN è¨ªå•æ¬Šé™

**ä¸»è¦åŠŸèƒ½ï¼š**
- æœç´¢å’Œæ’¤éŠ·ç”¨æˆ¶è­‰æ›¸
- æ–·é–‹æ´»èºé€£æ¥
- è™•ç† IAM æ¬Šé™
- ç”Ÿæˆæ’¤éŠ·å ±å‘Š

**é©ç”¨å°è±¡ï¼š** IT ç®¡ç†å“¡

### employee_offboarding.sh - é›¢è·è™•ç†ç³»çµ±

**ç”¨é€”ï¼š** å…¨é¢è™•ç†é›¢è·å“¡å·¥çš„å®‰å…¨æ¸…ç†

**ä¸»è¦åŠŸèƒ½ï¼š**
- ç·Šæ€¥å®‰å…¨æªæ–½
- å…¨é¢æ¬Šé™æ’¤éŠ·
- è¨ªå•æ—¥èªŒå¯©è¨ˆ
- å®‰å…¨å ±å‘Šç”Ÿæˆ
- é›¢è·æª¢æŸ¥æ¸…å–®

**é©ç”¨å°è±¡ï¼š** HRã€IT ç®¡ç†å“¡ã€å®‰å…¨åœ˜éšŠ

---

## è©³ç´°ä½¿ç”¨æŒ‡å—

### ç®¡ç†å“¡é¦–æ¬¡è¨­ç½®

#### æ­¥é©Ÿ 1ï¼šå»ºç«‹ VPN ç«¯é»

1. **åŸ·è¡Œç®¡ç†å“¡è…³æœ¬**
   ```bash
   ./aws_vpn_admin.sh
   ```

2. **é¸æ“‡é¸é … 1ï¼šå»ºç«‹æ–°çš„ VPN ç«¯é»**

3. **æŒ‰ç…§æç¤ºè¼¸å…¥è³‡è¨Šï¼š**
   - ç¢ºèª AWS é…ç½®
   - é¸æ“‡ç›®æ¨™ VPC
   - é¸æ“‡é—œè¯çš„å­ç¶²è·¯
   - è¨­å®š VPN CIDR ç¯„åœ
   - å‘½å VPN ç«¯é»

4. **ç­‰å¾…å»ºç«‹å®Œæˆ**
   - ç³»çµ±æœƒè‡ªå‹•ç”Ÿæˆè­‰æ›¸
   - å‰µå»º VPN ç«¯é»
   - é…ç½®ç¶²è·¯é—œè¯
   - è¨­ç½®æˆæ¬Šè¦å‰‡

5. **è¨˜éŒ„é‡è¦è³‡è¨Š**
   - VPN ç«¯é» ID
   - ç®¡ç†å“¡é…ç½®æª”æ¡ˆä½ç½®
   - åœ˜éšŠè¨­å®šæª”æ¡ˆä½ç½®

#### æ­¥é©Ÿ 2ï¼šæ¸¬è©¦ç®¡ç†å“¡é€£æ¥

1. **å®‰è£ AWS VPN å®¢æˆ¶ç«¯**
   - è…³æœ¬æœƒè‡ªå‹•ä¸‹è¼‰å®‰è£

2. **å°å…¥ç®¡ç†å“¡é…ç½®**
   - é–‹å•Ÿ AWS VPN å®¢æˆ¶ç«¯
   - æ·»åŠ é…ç½®æª”æ¡ˆï¼š`configs/admin-config.ovpn`
   - è¨­å®šæª”åç¨±ï¼šAdmin VPN

3. **æ¸¬è©¦é€£æ¥**
   - é€£æ¥åˆ° VPN
   - æ¸¬è©¦ ping ç§æœ‰è³‡æº
   - ç¢ºèªé€£æ¥æ—¥èªŒ

#### æ­¥é©Ÿ 3ï¼šæº–å‚™åœ˜éšŠè¨­å®š

1. **åŒ¯å‡ºåœ˜éšŠè¨­å®šæª”**
   - é¸æ“‡é¸é … 6ï¼šåŒ¯å‡ºåœ˜éšŠæˆå“¡è¨­å®šæª”

2. **åˆ†ç™¼çµ¦åœ˜éšŠæˆå“¡**
   - team_member_setup.sh
   - ca.crt æ–‡ä»¶
   - VPN ç«¯é» ID

### åœ˜éšŠæˆå“¡è¨­ç½®æµç¨‹

#### ç‚ºæ–°æˆå“¡è¨­ç½® VPN è¨ªå•

1. **æä¾›å¿…è¦æ–‡ä»¶**
   ```bash
   # åœ˜éšŠæˆå“¡æ‡‰è©²æ”¶åˆ°ï¼š
   # - team_member_setup.sh
   # - ca.crt
   # - VPN ç«¯é» ID
   ```

2. **åŸ·è¡Œè¨­ç½®è…³æœ¬**
   ```bash
   ./team_member_setup.sh
   ```

3. **æŒ‰ç…§æç¤ºå®Œæˆè¨­ç½®**
   - è¼¸å…¥ AWS èªè­‰è³‡è¨Š
   - è¼¸å…¥ VPN ç«¯é» ID
   - è¨­å®šç”¨æˆ¶å
   - ç”Ÿæˆå€‹äººè­‰æ›¸

4. **æ¸¬è©¦é€£æ¥**
   - ä½¿ç”¨ AWS VPN å®¢æˆ¶ç«¯
   - å°å…¥å€‹äººé…ç½®æª”æ¡ˆ
   - æ¸¬è©¦é€£æ¥åˆ°ç”Ÿç”¢ç’°å¢ƒ

### æ¬Šé™æ’¤éŠ·æµç¨‹

#### æ’¤éŠ·ç‰¹å®šæˆå“¡çš„è¨ªå•æ¬Šé™

1. **åŸ·è¡Œæ’¤éŠ·è…³æœ¬**
   ```bash
   ./revoke_member_access.sh
   ```

2. **æä¾›ç”¨æˆ¶è³‡è¨Š**
   - ç”¨æˆ¶å
   - VPN ç«¯é» ID
   - æ’¤éŠ·åŸå› 

3. **ç¢ºèªæ’¤éŠ·æ“ä½œ**
   - æª¢æŸ¥è¦æ’¤éŠ·çš„è­‰æ›¸
   - è¼¸å…¥ 'REVOKE' ç¢ºèª

4. **é©—è­‰æ’¤éŠ·çµæœ**
   - æª¢æŸ¥æ’¤éŠ·å ±å‘Š
   - ç¢ºèªç”¨æˆ¶ç„¡æ³•é€£æ¥

### é›¢è·è™•ç†æµç¨‹

#### å…¨é¢è™•ç†é›¢è·å“¡å·¥

1. **æº–å‚™é›¢è·è³‡è¨Š**
   - å“¡å·¥å§“åå’Œ ID
   - é›¢è·æ—¥æœŸå’Œé¡å‹
   - é¢¨éšªç­‰ç´šè©•ä¼°

2. **åŸ·è¡Œé›¢è·è…³æœ¬**
   ```bash
   ./employee_offboarding.sh
   ```

3. **æŒ‰ç…§åæ­¥é©Ÿæµç¨‹**
   - ç³»çµ±æª¢æŸ¥
   - è³‡è¨Šæ”¶é›†
   - ç·Šæ€¥æªæ–½ï¼ˆå¦‚éœ€è¦ï¼‰
   - è³‡æºåˆ†æ
   - VPN æ’¤éŠ·
   - IAM æ¸…ç†
   - æ—¥èªŒå¯©è¨ˆ
   - æ®˜ç•™æª¢æŸ¥
   - å ±å‘Šç”Ÿæˆ
   - æœ€çµ‚ç¢ºèª

4. **å®Œæˆæ‰‹å‹•æª¢æŸ¥æ¸…å–®**
   - ä½¿ç”¨ç”Ÿæˆçš„æª¢æŸ¥æ¸…å–®
   - å®Œæˆæ‰€æœ‰é›¢è·é …ç›®
   - ä¿ç•™æ–‡æª”ç”¨æ–¼å¯©è¨ˆ

---

## æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œå’Œè§£æ±ºæ–¹æ¡ˆ

#### 1. AWS æ¬Šé™éŒ¯èª¤

**å•é¡Œï¼š** `AccessDenied` éŒ¯èª¤
```
An error occurred (AccessDenied) when calling the DescribeClientVpnEndpoints operation
```

**è§£æ±ºæ–¹æ¡ˆï¼š**
1. æª¢æŸ¥ AWS èªè­‰é…ç½®
   ```bash
   aws sts get-caller-identity
   ```

2. ç¢ºèª IAM æ¬Šé™
   - æª¢æŸ¥ç”¨æˆ¶æ”¿ç­–
   - ç¢ºèªè³‡æºæ¬Šé™

3. æª¢æŸ¥å€åŸŸè¨­å®š
   ```bash
   aws configure get region
   ```

#### 2. è­‰æ›¸ç”Ÿæˆå¤±æ•—

**å•é¡Œï¼š** Easy-RSA è­‰æ›¸ç”ŸæˆéŒ¯èª¤

**è§£æ±ºæ–¹æ¡ˆï¼š**
1. æª¢æŸ¥ Easy-RSA å®‰è£
   ```bash
   which easyrsa
   easyrsa version
   ```

2. æ¸…ç†ä¸¦é‡æ–°åˆå§‹åŒ–
   ```bash
   rm -rf pki
   easyrsa init-pki
   ```

3. æª¢æŸ¥æ¬Šé™
   ```bash
   chmod 755 certificates/
   ```

#### 3. VPN é€£æ¥å¤±æ•—

**å•é¡Œï¼š** ç„¡æ³•é€£æ¥åˆ° VPN

**è§£æ±ºæ–¹æ¡ˆï¼š**
1. æª¢æŸ¥ç«¯é»ç‹€æ…‹
   ```bash
   aws ec2 describe-client-vpn-endpoints --client-vpn-endpoint-ids cvpn-xxxxxx
   ```

2. é©—è­‰é…ç½®æª”æ¡ˆ
   - æª¢æŸ¥è­‰æ›¸æ˜¯å¦æ­£ç¢ºåµŒå…¥
   - ç¢ºèªç«¯é» URL æ­£ç¢º

3. æª¢æŸ¥ç¶²è·¯é€£æ¥
   - æ¸¬è©¦åˆ° 443 ç«¯å£çš„é€£æ¥
   - æª¢æŸ¥é˜²ç«ç‰†è¨­å®š

#### 4. è…³æœ¬åŸ·è¡ŒéŒ¯èª¤

**å•é¡Œï¼š** è…³æœ¬ä¸­é€”åœæ­¢åŸ·è¡Œ

**è§£æ±ºæ–¹æ¡ˆï¼š**
1. æª¢æŸ¥è…³æœ¬æ¬Šé™
   ```bash
   chmod +x *.sh
   ```

2. æŸ¥çœ‹éŒ¯èª¤æ—¥èªŒ
   ```bash
   tail -f vpn_admin.log
   ```

3. å–®æ­¥é©ŸåŸ·è¡Œ
   - ä½¿ç”¨ bash -x èª¿è©¦
   ```bash
   bash -x aws_vpn_admin.sh
   ```

### æ—¥èªŒæ–‡ä»¶ä½ç½®

- **ç®¡ç†å“¡æ—¥èªŒï¼š** `vpn_admin.log`
- **åœ˜éšŠæˆå“¡æ—¥èªŒï¼š** `user_vpn_setup.log`
- **æ’¤éŠ·æ—¥èªŒï¼š** `revocation-logs/revocation.log`
- **é›¢è·æ—¥èªŒï¼š** `offboarding-logs/offboarding.log`

---

## å®‰å…¨æœ€ä½³å¯¦è¸

### è­‰æ›¸ç®¡ç†

1. **è­‰æ›¸è¼ªæ›**
   - å®šæœŸæ›´æ–° CA è­‰æ›¸ (æ¯å¹´)
   - è¼ªæ›å®¢æˆ¶ç«¯è­‰æ›¸ (æ¯ 6 å€‹æœˆ)
   - ç«‹å³æ’¤éŠ·æ´©éœ²çš„è­‰æ›¸

2. **å®‰å…¨å„²å­˜**
   - åŠ å¯†å„²å­˜ç§é‘°æ–‡ä»¶
   - é™åˆ¶ CA ç§é‘°è¨ªå•
   - ä½¿ç”¨å®‰å…¨çš„å‚™ä»½ç­–ç•¥
   - **ç”¨æˆ¶ç«¯ç§é‘°å®‰å…¨ï¼š** `team_member_setup.sh` æœƒç”¢ç”Ÿç”¨æˆ¶ç«¯æ†‘è­‰ï¼Œå…¶ä¸­åŒ…æ‹¬ä¸€å€‹ç§é‘°æª”æ¡ˆ (`.key`)ã€‚æ­¤ç§é‘°æœƒåµŒå…¥åˆ° `.ovpn` è¨­å®šæª”ä¸­ä»¥ä¾¿åˆ†ç™¼ã€‚ä½¿ç”¨è€…æ‡‰è¢«å‘ŠçŸ¥é€™äº› `.ovpn` æª”æ¡ˆå’Œç¨ç«‹çš„ `.key` æª”æ¡ˆï¼ˆå¦‚æœç”¢ç”Ÿï¼‰çš„æ•æ„Ÿæ€§ã€‚å»ºè­°ä½¿ç”¨è€…åœ¨æˆåŠŸè¨­å®š VPN é€£ç·šå¾Œï¼Œå¦¥å–„ä¿ç®¡é€™äº›æª”æ¡ˆï¼Œä¸¦è€ƒæ…®å¾æœ¬åœ°é›»è…¦ä¸Šåˆªé™¤åŸå§‹çš„ `.key` æª”æ¡ˆå‰¯æœ¬ï¼ˆå¦‚æœçµ„ç¹”ç­–ç•¥å…è¨±ä¸”å·²æœ‰å®‰å…¨å‚™ä»½ï¼‰ï¼Œä»¥é™ä½æ´©æ¼é¢¨éšªã€‚

3. **æª”æ¡ˆæ¬Šé™ç®¡ç†**
   - ç³»çµ±è‡ªå‹•è¨­ç½®æ•æ„Ÿæª”æ¡ˆæ¬Šé™ç‚º `600` (åƒ…æ‰€æœ‰è€…å¯è®€å¯«)
   - è­‰æ›¸ç›®éŒ„æ¬Šé™è¨­ç‚º `700` (åƒ…æ‰€æœ‰è€…å¯å­˜å–)
   - å®šæœŸæª¢æŸ¥æª”æ¡ˆæ¬Šé™æ˜¯å¦è¢«æ„å¤–æ›´æ”¹
   ```bash
   # æª¢æŸ¥æ•æ„Ÿæª”æ¡ˆæ¬Šé™
   find . -name "*.key" -exec ls -la {} \;
   find . -name "*.ovpn" -exec ls -la {} \;
   ```

### è¨ªå•æ§åˆ¶

1. **æœ€å°æ¬Šé™åŸå‰‡**
   - åƒ…æˆäºˆå¿…è¦çš„ AWS æ¬Šé™
   - å®šæœŸå¯©æŸ¥ç”¨æˆ¶æ¬Šé™
   - ä½¿ç”¨ IAM è§’è‰²å’Œç¾¤çµ„

2. **ç¶²è·¯åˆ†æ®µ**
   - é™åˆ¶ VPN å¯è¨ªå•çš„è³‡æº
   - ä½¿ç”¨å®‰å…¨çµ„æ§åˆ¶æµé‡
   - å¯¦æ–½ç¶²è·¯ç›£æ§

### æ•æ„Ÿæª”æ¡ˆå‚™ä»½ç­–ç•¥

1. **åŠ å¯†å‚™ä»½**
   ```bash
   # å»ºè­°çš„å‚™ä»½è…³æœ¬ç¯„ä¾‹
   tar -czf vpn_backup_$(date +%Y%m%d).tar.gz \
       .vpn_config certificates/ configs/ \
       --exclude="*.log"
   
   # åŠ å¯†å‚™ä»½æª”æ¡ˆ
   gpg --symmetric --cipher-algo AES256 vpn_backup_$(date +%Y%m%d).tar.gz
   ```

2. **é›¢ç·šå„²å­˜**
   - å°‡åŠ å¯†å‚™ä»½å„²å­˜åˆ°é›¢ç·šåª’é«”
   - å®šæœŸæ¸¬è©¦å‚™ä»½æ¢å¾©ç¨‹åº
   - åœ¨å®‰å…¨åœ°é»ä¿å­˜å‚™ä»½

### ç›£æ§å’Œå¯©è¨ˆ

1. **é€£æ¥ç›£æ§**
   - å•Ÿç”¨ VPN é€£æ¥æ—¥èªŒ
   - è¨­ç½®ç•°å¸¸é€£æ¥è­¦å ±
   - å®šæœŸæª¢æŸ¥é€£æ¥æ¨¡å¼

2. **å¯©è¨ˆè¿½è¹¤**
   - ä¿ç•™æ‰€æœ‰æ“ä½œæ—¥èªŒ
   - å®šæœŸå¯©æŸ¥æ¬Šé™è®Šæ›´
   - å»ºç«‹äº‹ä»¶å›æ‡‰ç¨‹åº

3. **æª”æ¡ˆå®Œæ•´æ€§ç›£æ§**
   ```bash
   # å»ºè­°å®šæœŸæª¢æŸ¥é‡è¦æª”æ¡ˆçš„å®Œæ•´æ€§
   find . -name "*.key" -o -name "*.crt" -o -name ".vpn_config" | \
   xargs shasum -a 256 > file_checksums.txt
   ```

### æ‡‰æ€¥éŸ¿æ‡‰

1. **å®‰å…¨äº‹ä»¶**
   - ç«‹å³æ–·é–‹å¯ç–‘é€£æ¥
   - æ’¤éŠ·ç›¸é—œè­‰æ›¸
   - é€šçŸ¥å®‰å…¨åœ˜éšŠ

2. **æ´©éœ²éŸ¿æ‡‰**
   - è©•ä¼°æ´©éœ²ç¯„åœ
   - é‡æ–°ç”Ÿæˆå—å½±éŸ¿è­‰æ›¸
   - æ›´æ–°è¨ªå•æ§åˆ¶

---

## å¸¸è¦‹å•é¡Œ

### Q: å¯ä»¥åŒæ™‚å»ºç«‹å¤šå€‹ VPN ç«¯é»å—ï¼Ÿ
A: æ˜¯çš„ï¼Œå¯ä»¥ç‚ºä¸åŒç’°å¢ƒæˆ–åœ˜éšŠå»ºç«‹å¤šå€‹ç«¯é»ã€‚æ¯å€‹ç«¯é»ä½¿ç”¨ä¸åŒçš„ CIDR ç¯„åœå’Œè­‰æ›¸ã€‚

### Q: å¦‚ä½•è™•ç†è­‰æ›¸éæœŸï¼Ÿ
A: è­‰æ›¸éæœŸå‰ 30 å¤©æœƒåœ¨æ—¥èªŒä¸­è­¦å‘Šã€‚éœ€è¦é‡æ–°ç”Ÿæˆè­‰æ›¸ä¸¦åˆ†ç™¼çµ¦ç”¨æˆ¶ã€‚

### Q: å¯ä»¥é™åˆ¶ç‰¹å®šç”¨æˆ¶åªèƒ½è¨ªå•ç‰¹å®šè³‡æºå—ï¼Ÿ
A: å¯ä»¥ã€‚é€šé VPN ç«¯é»çš„æˆæ¬Šè¦å‰‡å’Œå®‰å…¨çµ„ä¾†æ§åˆ¶è¨ªå•ç¯„åœã€‚

### Q: å¦‚ä½•å‚™ä»½ VPN é…ç½®ï¼Ÿ
A: å‚™ä»½ä»¥ä¸‹æ–‡ä»¶ï¼š
- æ‰€æœ‰è­‰æ›¸æ–‡ä»¶
- VPN ç«¯é»é…ç½®
- ç”¨æˆ¶æ¸…å–®
- é…ç½®æ–‡ä»¶

### Q: æ”¯æ´å¤šå› ç´ èªè­‰å—ï¼Ÿ
A: ç›®å‰ä½¿ç”¨è­‰æ›¸èªè­‰ã€‚å¯ä»¥åœ¨ AWS ç«¯é…ç½® SAML æˆ–å…¶ä»–èªè­‰æ–¹å¼ã€‚

### Q: å¦‚ä½•ç›£æ§ VPN ä½¿ç”¨é‡ï¼Ÿ
A: é€šé CloudWatch ç›£æ§é€£æ¥æ•¸é‡ã€æµé‡å’Œé€£æ¥æ™‚é–“ã€‚

### Q: å·¥å…·æœƒä½”ç”¨å¤šå°‘ç£ç¢Ÿç©ºé–“ï¼Ÿ
A: ç´„ 871MBï¼ŒåŒ…æ‹¬ï¼š
- è­‰æ›¸å’Œé…ç½®æª”æ¡ˆï¼š~56MB
- è»Ÿé«”å·¥å…·ï¼š~815MB (Homebrewã€AWS CLIã€VPN Client ç­‰)

### Q: å¦‚ä½•ç¢ºä¿æª”æ¡ˆå®‰å…¨ï¼Ÿ
A: å·¥å…·æœƒè‡ªå‹•è¨­ç½®é©ç•¶çš„æª”æ¡ˆæ¬Šé™ï¼Œæ‰€æœ‰æ•æ„Ÿæª”æ¡ˆåƒ…æ‰€æœ‰è€…å¯å­˜å–ã€‚å»ºè­°å®šæœŸå‚™ä»½åˆ°åŠ å¯†å„²å­˜è£ç½®ã€‚

---

## ç¶­è­·å’Œç›£æ§

### å®šæœŸç¶­è­·ä»»å‹™

#### æ¯é€±ä»»å‹™
- [ ] æª¢æŸ¥ VPN ç«¯é»å¥åº·ç‹€æ…‹
- [ ] å¯©æŸ¥é€£æ¥æ—¥èªŒ
- [ ] é©—è­‰å‚™ä»½å®Œæ•´æ€§
- [ ] æª¢æŸ¥æ•æ„Ÿæª”æ¡ˆæ¬Šé™

#### æ¯æœˆä»»å‹™
- [ ] æ›´æ–°åœ˜éšŠæˆå“¡æ¸…å–®
- [ ] æª¢æŸ¥è­‰æ›¸éæœŸç‹€æ…‹
- [ ] å¯©æŸ¥å®‰å…¨çµ„è¦å‰‡
- [ ] æ¸¬è©¦æ‡‰æ€¥éŸ¿æ‡‰ç¨‹åº
- [ ] æ¸…ç†éæœŸæ—¥èªŒæª”æ¡ˆ

#### æ¯å­£ä»»å‹™
- [ ] å…¨é¢æ¬Šé™å¯©è¨ˆ
- [ ] æ›´æ–°å®‰å…¨æ”¿ç­–
- [ ] æ•ˆèƒ½å„ªåŒ–è©•ä¼°
- [ ] ç½é›£æ¢å¾©æ¸¬è©¦
- [ ] æª”æ¡ˆå®Œæ•´æ€§æª¢æŸ¥

### ç›£æ§æŒ‡æ¨™

1. **é€£æ¥æŒ‡æ¨™**
   - åŒæ™‚é€£æ¥æ•¸
   - é€£æ¥æˆåŠŸç‡
   - å¹³å‡é€£æ¥æ™‚é–“

2. **å®‰å…¨æŒ‡æ¨™**
   - å¤±æ•—ç™»å…¥æ¬¡æ•¸
   - ç•°å¸¸é€£æ¥æ¨¡å¼
   - è­‰æ›¸ä½¿ç”¨ç‹€æ³

3. **ç³»çµ±æŒ‡æ¨™**
   - ç£ç¢Ÿç©ºé–“ä½¿ç”¨
   - æ—¥èªŒæª”æ¡ˆå¤§å°
   - å‚™ä»½ç‹€æ…‹

### è‡ªå‹•åŒ–ç›£æ§è¨­ç½®

```bash
# è¨­ç½®æ¯æ—¥å¥åº·æª¢æŸ¥
crontab -e

# æ·»åŠ ä»¥ä¸‹è¡Œï¼š
0 9 * * * /path/to/aws_vpn_admin.sh health-check
0 18 * * * /path/to/check_certificate_expiry.sh
0 2 * * 0 /path/to/backup_vpn_configs.sh  # æ¯é€±å‚™ä»½
```

---

## å®Œæ•´ç§»é™¤æŒ‡å—

å¦‚æœæ‚¨éœ€è¦å®Œå…¨ç§»é™¤æ­¤å·¥å…·å¥—ä»¶åŠå…¶æ‰€æœ‰å½±éŸ¿ï¼Œè«‹æŒ‰ç…§ä»¥ä¸‹æ­¥é©Ÿï¼š

### 1. åœæ­¢æ‰€æœ‰ VPN é€£æ¥
```bash
# åœ¨ AWS VPN Client ä¸­æ–·é–‹æ‰€æœ‰é€£æ¥
# æˆ–ä½¿ç”¨å‘½ä»¤åˆ— (å¦‚æœæ”¯æ´)
sudo pkill -f "AWS VPN Client"
```

### 2. åˆªé™¤å°ˆæ¡ˆæª”æ¡ˆå’Œè³‡æ–™
```bash
# åˆ‡æ›åˆ°å°ˆæ¡ˆç›®éŒ„çš„ä¸Šå±¤
cd /path/to/parent/directory

# å®‰å…¨åˆªé™¤æ•´å€‹å°ˆæ¡ˆç›®éŒ„ (åŒ…å«æ‰€æœ‰æ•æ„Ÿæª”æ¡ˆ)
rm -rf aws-vpn-tools/

# æˆ–ä½¿ç”¨å®‰å…¨åˆªé™¤ (å¦‚æœå¯ç”¨)
srm -rf aws-vpn-tools/  # macOS
```

### 3. ç§»é™¤ AWS é…ç½® (è¬¹æ…æ“ä½œ)
```bash
# âš ï¸ æ³¨æ„ï¼šé€™æœƒåˆªé™¤æ‰€æœ‰ AWS CLI é…ç½®
# å¦‚æœæ‚¨ä½¿ç”¨ AWS CLI é€²è¡Œå…¶ä»–ç”¨é€”ï¼Œè«‹å…ˆå‚™ä»½

# æª¢æŸ¥ç¾æœ‰é…ç½®
aws configure list-profiles

# åƒ…åˆªé™¤ç‰¹å®š profile (æ¨è–¦)
aws configure remove-profile [profile_name]

# æˆ–å®Œå…¨ç§»é™¤ AWS é…ç½® (è¬¹æ…)
rm -rf ~/.aws/
```

### 4. ç§»é™¤å·²å®‰è£çš„æ‡‰ç”¨ç¨‹å¼
```bash
# ç§»é™¤ AWS VPN Client
sudo rm -rf "/Applications/AWS VPN Client.app"

# æ¸…ç† Downloads ä¸­çš„å®‰è£æª”æ¡ˆ
rm -f ~/Downloads/AWS_VPN_Client.pkg
```

### 5. ç§»é™¤ Homebrew å®‰è£çš„å·¥å…· (å¯é¸)
```bash
# å¦‚æœé€™äº›å·¥å…·åƒ…ç‚ºæ­¤å°ˆæ¡ˆå®‰è£ï¼Œå¯ä»¥ç§»é™¤ï¼š
brew uninstall awscli
brew uninstall jq
brew uninstall easy-rsa

# æª¢æŸ¥å…¶ä»–ä¾è³´çš„æ‡‰ç”¨ç¨‹å¼
brew uses awscli
brew uses jq
```

### 6. æ¸…ç†ç³»çµ±è¨­å®š
```bash
# æª¢æŸ¥ä¸¦æ¸…ç† shell é…ç½®æª”æ¡ˆä¸­çš„ PATH ä¿®æ”¹
# (Homebrew å®‰è£æ™‚å¯èƒ½æ·»åŠ çš„)
nano ~/.zshrc      # æˆ– ~/.bash_profile
# ç§»é™¤ Homebrew ç›¸é—œçš„ PATH è¨­å®š (å¦‚æœä¸å†éœ€è¦)

# é‡æ–°è¼‰å…¥ shell é…ç½®
source ~/.zshrc
```

### 7. æ¸…ç†ç¶²è·¯è¨­å®š
```bash
# VPN Client ç§»é™¤å¾Œï¼Œç¶²è·¯è¨­å®šé€šå¸¸æœƒè‡ªå‹•æ¸…ç†
# ä½†å¯ä»¥æª¢æŸ¥æ˜¯å¦æœ‰æ®˜ç•™çš„ VPN ä»‹é¢æˆ–è·¯ç”±
ifconfig | grep -E "(utun|tun)"
netstat -rn | grep -E "(utun|tun)"
```

### 8. AWS é›²ç«¯è³‡æºæ¸…ç†
```bash
# âš ï¸ é‡è¦ï¼šåŒæ™‚æ¸…ç† AWS ä¸Šçš„ç›¸é—œè³‡æº
# ä½¿ç”¨ aws_vpn_admin.sh çš„åˆªé™¤åŠŸèƒ½ï¼Œæˆ–æ‰‹å‹•æ¸…ç†ï¼š

# åˆªé™¤ Client VPN ç«¯é»
aws ec2 delete-client-vpn-endpoint --client-vpn-endpoint-id cvpn-xxxxxx

# åˆªé™¤ ACM è­‰æ›¸
aws acm delete-certificate --certificate-arn arn:aws:acm:...

# åˆªé™¤ CloudWatch æ—¥èªŒç¾¤çµ„
aws logs delete-log-group --log-group-name /aws/clientvpn/...
```

### 9. é©—è­‰ç§»é™¤å®Œæ•´æ€§
```bash
# æª¢æŸ¥æ˜¯å¦é‚„æœ‰æ®˜ç•™æª”æ¡ˆ
find / -name "*vpn*" -type f 2>/dev/null | grep -v "/System/"
find / -name "*aws-vpn*" 2>/dev/null

# æª¢æŸ¥æ˜¯å¦é‚„æœ‰ç›¸é—œç¨‹åº
ps aux | grep -i vpn
ps aux | grep -i aws

# æª¢æŸ¥ç¶²è·¯é€£æ¥
lsof -i | grep -i vpn
```

### 10. å®‰å…¨ç¢ºèª
```bash
# ç¢ºèªæ•æ„Ÿè³‡æ–™å·²å®‰å…¨ç§»é™¤
# (é€™äº›æª”æ¡ˆæ‡‰è©²åœ¨æ­¥é©Ÿ 2 ä¸­å·²è¢«åˆªé™¤)
ls -la ~/.aws/ 2>/dev/null || echo "AWS é…ç½®å·²ç§»é™¤"
ls -la /Applications/ | grep -i vpn || echo "VPN æ‡‰ç”¨ç¨‹å¼å·²ç§»é™¤"
```

### å®Œæ•´ç§»é™¤æª¢æŸ¥æ¸…å–®
- [ ] æ–·é–‹æ‰€æœ‰ VPN é€£æ¥
- [ ] åˆªé™¤å°ˆæ¡ˆç›®éŒ„å’Œæ‰€æœ‰æª”æ¡ˆ
- [ ] ç§»é™¤æˆ–é‡æ–°é…ç½® AWS CLI è¨­å®š
- [ ] ç§»é™¤ AWS VPN Client æ‡‰ç”¨ç¨‹å¼
- [ ] ç§»é™¤ä¸éœ€è¦çš„ Homebrew å·¥å…·
- [ ] æ¸…ç† shell é…ç½®æª”æ¡ˆ
- [ ] æª¢æŸ¥ç¶²è·¯è¨­å®š
- [ ] æ¸…ç† AWS é›²ç«¯è³‡æº
- [ ] é©—è­‰æ²’æœ‰æ®˜ç•™æª”æ¡ˆæˆ–ç¨‹åº
- [ ] ç¢ºèªæ•æ„Ÿè³‡æ–™å·²å®‰å…¨ç§»é™¤

**æ³¨æ„ï¼š** å®Œæ•´ç§»é™¤å¾Œï¼Œå¦‚æœéœ€è¦é‡æ–°ä½¿ç”¨ VPN åŠŸèƒ½ï¼Œæ‚¨éœ€è¦é‡æ–°åŸ·è¡Œå®Œæ•´çš„è¨­ç½®ç¨‹åºã€‚

---

## é™„éŒ„

### A. é…ç½®æ–‡ä»¶ç¯„ä¾‹

#### VPN å®¢æˆ¶ç«¯é…ç½®æ–‡ä»¶çµæ§‹
```
client
dev tun
proto udp
remote cvpn-endpoint-xxx.prod.clientvpn.ap-northeast-1.amazonaws.com 443
remote-random-hostname
resolv-retry infinite
nobind
persist-key
persist-tun
remote-cert-tls server
cipher AES-256-GCM
verb 3
reneg-sec 0

<cert>
-----BEGIN CERTIFICATE-----
[è­‰æ›¸å…§å®¹]
-----END CERTIFICATE-----
</cert>

<key>
-----BEGIN PRIVATE KEY-----
[ç§é‘°å…§å®¹]
-----END PRIVATE KEY-----
</key>
```

### B. AWS CLI å‘½ä»¤åƒè€ƒ

#### å¸¸ç”¨ VPN ç®¡ç†å‘½ä»¤
```bash
# åˆ—å‡ºæ‰€æœ‰ VPN ç«¯é»
aws ec2 describe-client-vpn-endpoints

# æŸ¥çœ‹ç‰¹å®šç«¯é»è©³æƒ…
aws ec2 describe-client-vpn-endpoints --client-vpn-endpoint-ids cvpn-xxxxx

# æŸ¥çœ‹ç•¶å‰é€£æ¥
aws ec2 describe-client-vpn-connections --client-vpn-endpoint-id cvpn-xxxxx

# ä¸‹è¼‰å®¢æˆ¶ç«¯é…ç½®
aws ec2 export-client-vpn-client-configuration --client-vpn-endpoint-id cvpn-xxxxx

# æŸ¥çœ‹æˆæ¬Šè¦å‰‡
aws ec2 describe-client-vpn-authorization-rules --client-vpn-endpoint-id cvpn-xxxxx

# æŸ¥çœ‹è·¯ç”±
aws ec2 describe-client-vpn-routes --client-vpn-endpoint-id cvpn-xxxxx
```

### C. ç·Šæ€¥è¯çµ¡è³‡è¨Šç¯„æœ¬

```
=== VPN ç·Šæ€¥è¯çµ¡è³‡è¨Š ===

IT ç®¡ç†å“¡: [å§“å] - [é›»è©±] - [éƒµä»¶]
å®‰å…¨åœ˜éšŠ: [å§“å] - [é›»è©±] - [éƒµä»¶]
AWS æ”¯æ´: [æ¡ˆä¾‹ ID] - [æ”¯æ´ç­‰ç´š]

ç·Šæ€¥ç¨‹åº:
1. ç«‹å³è¯ç¹« IT ç®¡ç†å“¡
2. å¦‚ç„¡æ³•è¯ç¹«ï¼Œè¯ç¹«å®‰å…¨åœ˜éšŠ
3. è¨˜éŒ„äº‹ä»¶è©³æƒ…
4. åŸ·è¡Œæ‡‰æ€¥éŸ¿æ‡‰ç¨‹åº
```

### D. æ•…éšœæ’é™¤æª¢æŸ¥æ¸…å–®

```
â–¡ æª¢æŸ¥ AWS èªè­‰é…ç½®
â–¡ é©—è­‰ IAM æ¬Šé™
â–¡ ç¢ºèªç¶²è·¯é€£æ¥
â–¡ æª¢æŸ¥ç«¯é»ç‹€æ…‹
â–¡ é©—è­‰è­‰æ›¸æœ‰æ•ˆæ€§
â–¡ æŸ¥çœ‹é€£æ¥æ—¥èªŒ
â–¡ æ¸¬è©¦ DNS è§£æ
â–¡ ç¢ºèªå®‰å…¨çµ„è¦å‰‡
â–¡ æª¢æŸ¥è·¯ç”±è¡¨
â–¡ é©—è­‰å®¢æˆ¶ç«¯é…ç½®
â–¡ æª¢æŸ¥æª”æ¡ˆæ¬Šé™
â–¡ é©—è­‰ç£ç¢Ÿç©ºé–“
```

### E. æª”æ¡ˆæ¬Šé™å¿«é€Ÿæª¢æŸ¥è…³æœ¬

```bash
#!/bin/bash
# æª”æ¡ˆæ¬Šé™æª¢æŸ¥è…³æœ¬

echo "=== VPN å·¥å…·æª”æ¡ˆæ¬Šé™æª¢æŸ¥ ==="

# æª¢æŸ¥é…ç½®æª”æ¡ˆ
for file in .vpn_config .user_vpn_config; do
    if [ -f "$file" ]; then
        perms=$(stat -f "%Lp" "$file")
        if [ "$perms" = "600" ]; then
            echo "âœ“ $file: æ¬Šé™æ­£ç¢º ($perms)"
        else
            echo "âœ— $file: æ¬Šé™ä¸å®‰å…¨ ($perms), æ‡‰ç‚º 600"
        fi
    fi
done

# æª¢æŸ¥è­‰æ›¸æª”æ¡ˆ
find . -name "*.key" -o -name "*.crt" | while read file; do
    perms=$(stat -f "%Lp" "$file")
    if [ "$perms" = "600" ]; then
        echo "âœ“ $file: æ¬Šé™æ­£ç¢º ($perms)"
    else
        echo "âœ— $file: æ¬Šé™ä¸å®‰å…¨ ($perms), æ‡‰ç‚º 600"
    fi
done

# æª¢æŸ¥æ•æ„Ÿç›®éŒ„
for dir in certificates user-certificates; do
    if [ -d "$dir" ]; then
        perms=$(stat -f "%Lp" "$dir")
        if [ "$perms" = "700" ]; then
            echo "âœ“ $dir/: æ¬Šé™æ­£ç¢º ($perms)"
        else
            echo "âœ— $dir/: æ¬Šé™ä¸å®‰å…¨ ($perms), æ‡‰ç‚º 700"
        fi
    fi
done
```

---

## ç‰ˆæœ¬æ­·å²

- **v1.0** (2024-05) - åˆå§‹ç‰ˆæœ¬ç™¼å¸ƒ
  - åŸºæœ¬ VPN ç®¡ç†åŠŸèƒ½
  - åœ˜éšŠæˆå“¡è¨­ç½®
  - æ¬Šé™æ’¤éŠ·
  - é›¢è·è™•ç†
  - å®Œæ•´çš„æª”æ¡ˆç³»çµ±å½±éŸ¿èªªæ˜

---

**æœ€å¾Œæ›´æ–°ï¼š** 2024å¹´5æœˆ
**æ–‡æª”ç‰ˆæœ¬ï¼š** 1.1
**é©ç”¨å·¥å…·ç‰ˆæœ¬ï¼š** 1.0