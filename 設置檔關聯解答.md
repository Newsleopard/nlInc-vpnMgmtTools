# 設置檔關聯解答總結

## 問題解答

### Q1: 以上兩個檔案跟 AWS profile 是什麼關聯？

**答案：** 設置檔透過 `AWS_PROFILE` 變數直接關聯到對應的 AWS profile：

```bash
# configs/staging/staging.env
AWS_PROFILE=staging-vpn-admin    # 指定 staging 環境使用的 AWS profile

# configs/production/production.env  
AWS_PROFILE=production-vpn-admin # 指定 production 環境使用的 AWS profile
```

**關聯機制：**
1. 當環境管理器載入環境配置時，會自動讀取並設定 `AWS_PROFILE` 環境變數
2. 所有後續的 AWS CLI 命令都會使用該 profile 執行
3. 確保 VPN 操作在正確的 AWS 帳戶中進行

### Q2: vpn_admin.sh 在建立 vpn endpoint 時會先參考 aws profile 還是 environment setting？

**答案：** **優先參考 environment setting**，然後自動設定對應的 AWS profile

**執行順序：**
```
1. vpn_admin.sh 啟動
   ↓
2. 載入當前環境設定 (透過 env_manager.sh)
   ↓
3. 讀取環境設置檔 (staging.env 或 production.env)
   ↓
4. 自動設定 AWS_PROFILE 環境變數
   ↓
5. 驗證 AWS profile 有效性
   ↓
6. 執行 VPN endpoint 建立作業
```

**優先順序：**
1. **環境設置檔中的 `ENV_AWS_PROFILE`** (環境特定覆寫)
2. **環境設置檔中的 `AWS_PROFILE`** (標準設定) ⭐ **主要方式**
3. **系統預設對應** (staging → default, production → production)
4. **AWS CLI 預設 profile** (回退選項)

## 實際驗證

使用提供的驗證工具確認設定：
```bash
./validate_aws_profile_config.sh
```

## 關鍵檔案

- `configs/staging.env.example` - Staging 環境設定範例
- `configs/production.env.example` - Production 環境設定範例  
- `AWS_PROFILE_配置關聯說明.md` - 詳細關聯說明文件
- `validate_aws_profile_config.sh` - 配置驗證工具

## 總結

vpn_admin.sh 建立 VPN endpoint 時：
1. **先參考 environment setting** (環境設置檔)
2. **自動對應到正確的 AWS profile**
3. **在指定的 AWS 帳戶中執行操作**

這確保了環境隔離和操作安全性。