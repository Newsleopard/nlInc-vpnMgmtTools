# AWS Client VPN ç®¡ç†å“¡æ‰‹å†Š

## ç›®éŒ„

1. [ç®¡ç†å“¡è·è²¬æ¦‚è¿°](#ç®¡ç†å“¡è·è²¬æ¦‚è¿°)
2. [ç’°å¢ƒç®¡ç†](#ç’°å¢ƒç®¡ç†)
3. [è­‰æ›¸ç®¡ç†](#è­‰æ›¸ç®¡ç†)
4. [ä½¿ç”¨è€…æ¬Šé™ç®¡ç†](#ä½¿ç”¨è€…æ¬Šé™ç®¡ç†)
5. [VPN ç«¯é»ç®¡ç†](#vpn-ç«¯é»ç®¡ç†)
6. [S3 è­‰æ›¸äº¤æ›ç³»çµ±](#s3-è­‰æ›¸äº¤æ›ç³»çµ±)
7. [Slack ç®¡ç†æŒ‡ä»¤](#slack-ç®¡ç†æŒ‡ä»¤)
8. [ç›£æ§èˆ‡å ±å‘Š](#ç›£æ§èˆ‡å ±å‘Š)
9. [æ•…éšœè™•ç†](#æ•…éšœè™•ç†)
10. [å®‰å…¨æœ€ä½³å¯¦è¸](#å®‰å…¨æœ€ä½³å¯¦è¸)
11. [ç®¡ç†å·¥å…·åƒè€ƒ](#ç®¡ç†å·¥å…·åƒè€ƒ)

## ç®¡ç†å“¡è·è²¬æ¦‚è¿°

ä½œç‚º AWS Client VPN ç³»çµ±ç®¡ç†å“¡ï¼Œæ‚¨çš„ä¸»è¦è·è²¬åŒ…æ‹¬ï¼š

### æ ¸å¿ƒè·è²¬

1. **è­‰æ›¸ç®¡ç†**
   - ç°½ç™¼åœ˜éšŠæˆå“¡çš„è­‰æ›¸è«‹æ±‚
   - æ’¤éŠ·é›¢è·å“¡å·¥çš„è­‰æ›¸
   - ç¶­è­· CA è­‰æ›¸å®‰å…¨

2. **ä½¿ç”¨è€…ç®¡ç†**
   - æ–°å¢å’Œç§»é™¤ä½¿ç”¨è€…æ¬Šé™
   - ç®¡ç† IAM æ”¿ç­–åˆ†é…
   - è™•ç†æ¬Šé™å•é¡Œ

3. **ç’°å¢ƒç¶­è­·**
   - ç®¡ç† Staging å’Œ Production ç’°å¢ƒ
   - ç›£æ§ç³»çµ±å¥åº·ç‹€æ…‹
   - è™•ç†æ•…éšœå’Œç•°å¸¸

4. **æˆæœ¬æ§åˆ¶**
   - ç›£æ§ VPN ä½¿ç”¨æƒ…æ³
   - å„ªåŒ–æˆæœ¬è¨­å®š
   - ç”Ÿæˆæˆæœ¬å ±å‘Š

### æ¬Šé™è¦æ±‚

ç®¡ç†å“¡éœ€è¦ä»¥ä¸‹ AWS æ¬Šé™ï¼š
- EC2 VPN ç«¯é»ç®¡ç†æ¬Šé™
- ACM è­‰æ›¸ç®¡ç†æ¬Šé™
- IAM ä½¿ç”¨è€…å’Œæ”¿ç­–ç®¡ç†æ¬Šé™
- S3 å­˜å–æ¬Šé™ï¼ˆè­‰æ›¸äº¤æ›æ¡¶ï¼‰
- CloudWatch æ—¥èªŒè®€å–æ¬Šé™

## ç’°å¢ƒç®¡ç†

### ç’°å¢ƒæ¶æ§‹

ç³»çµ±æ”¯æ´å…©å€‹ç¨ç«‹ç’°å¢ƒï¼š

```
ç’°å¢ƒçµæ§‹ï¼š
â”œâ”€â”€ Staging (æ¸¬è©¦ç’°å¢ƒ) ğŸŸ¡
â”‚   â”œâ”€â”€ ç”¨é€”ï¼šé–‹ç™¼ã€æ¸¬è©¦ã€é©—è­‰
â”‚   â”œâ”€â”€ å®‰å…¨ç­‰ç´šï¼šæ¨™æº–
â”‚   â””â”€â”€ ç¢ºèªè¦æ±‚ï¼šç°¡åŒ–
â”‚
â””â”€â”€ Production (æ­£å¼ç’°å¢ƒ) ğŸ”´
    â”œâ”€â”€ ç”¨é€”ï¼šæ­£å¼ç‡Ÿé‹
    â”œâ”€â”€ å®‰å…¨ç­‰ç´šï¼šæœ€é«˜
    â””â”€â”€ ç¢ºèªè¦æ±‚ï¼šå¤šé‡ç¢ºèª
```

### ç’°å¢ƒåˆ‡æ›æ“ä½œ

#### æŸ¥çœ‹ç•¶å‰ç’°å¢ƒ
```bash
./admin-tools/vpn_env.sh status
```

è¼¸å‡ºç¯„ä¾‹ï¼š
```
=== VPN Environment Status ===
Current Environment: staging
AWS Profile: staging-vpn-admin
Account ID: 123456789012
Region: us-east-1
Health: âœ… Healthy
```

#### åˆ‡æ›ç’°å¢ƒ
```bash
# åˆ‡æ›åˆ° Staging
./admin-tools/vpn_env.sh switch staging

# åˆ‡æ›åˆ° Productionï¼ˆéœ€è¦é¡å¤–ç¢ºèªï¼‰
./admin-tools/vpn_env.sh switch production
```

#### ä½¿ç”¨äº’å‹•å¼é¸æ“‡å™¨
```bash
./enhanced_env_selector.sh
```

### AWS Profile ç®¡ç†

ç³»çµ±æ”¯æ´æ™ºèƒ½ AWS Profile ç®¡ç†ï¼š

#### è¨­å®šç’°å¢ƒå°ˆç”¨ Profile
```bash
# ç‚ºç•¶å‰ç’°å¢ƒè¨­å®šç‰¹å®š Profile
./admin-tools/aws_vpn_admin.sh --set-profile my-staging-profile

# é‡ç½®ç‚ºè‡ªå‹•æª¢æ¸¬
./admin-tools/aws_vpn_admin.sh --reset-profile

# æŸ¥çœ‹ Profile ç‹€æ…‹
./admin-tools/aws_vpn_admin.sh --profile-status
```

#### Profile é…ç½®å»ºè­°
```bash
# ~/.aws/credentials
[staging-vpn-admin]
aws_access_key_id = AKIA...
aws_secret_access_key = ...

[production-vpn-admin]
aws_access_key_id = AKIA...
aws_secret_access_key = ...
```

## è­‰æ›¸ç®¡ç†

### è­‰æ›¸æ¶æ§‹æ¦‚è¿°

```
è­‰æ›¸å±¤ç´šï¼š
â”œâ”€â”€ CA è­‰æ›¸ï¼ˆæ ¹è­‰æ›¸ï¼‰
â”‚   â”œâ”€â”€ ç”¨é€”ï¼šç°½ç™¼å®¢æˆ¶ç«¯è­‰æ›¸
â”‚   â”œâ”€â”€ æœ‰æ•ˆæœŸï¼šé€šå¸¸ 10 å¹´
â”‚   â””â”€â”€ ç§é‘°ï¼šå¿…é ˆåš´æ ¼ä¿è­·
â”‚
â””â”€â”€ å®¢æˆ¶ç«¯è­‰æ›¸
    â”œâ”€â”€ ç”¨é€”ï¼šä½¿ç”¨è€…èº«ä»½é©—è­‰
    â”œâ”€â”€ æœ‰æ•ˆæœŸï¼šé€šå¸¸ 1 å¹´
    â””â”€â”€ ç§é‘°ï¼šä½¿ç”¨è€…è‡ªè¡Œä¿ç®¡
```

### ç°½ç™¼è­‰æ›¸æµç¨‹

#### 1. å–®ä¸€è­‰æ›¸ç°½ç™¼

ç•¶åœ˜éšŠæˆå“¡æäº¤ CSR å¾Œï¼š

```bash
# å‚³çµ±æœ¬åœ°ç°½ç™¼
./admin-tools/sign_csr.sh -e staging username.csr

# é›¶æ¥è§¸æµç¨‹ï¼ˆè‡ªå‹•ä¸Šå‚³åˆ° S3ï¼‰
./admin-tools/sign_csr.sh --upload-s3 username.csr
```

#### 2. æ‰¹æ¬¡è­‰æ›¸è™•ç†

è™•ç†å¤šå€‹ CSR è«‹æ±‚ï¼š

```bash
# ä¸‹è¼‰æ‰€æœ‰å¾…è™•ç†çš„ CSR
./admin-tools/process_csr_batch.sh download -e production

# æ‰¹æ¬¡ç°½ç™¼è­‰æ›¸
./admin-tools/process_csr_batch.sh process -e production

# ä¸Šå‚³ç°½ç™¼çš„è­‰æ›¸
./admin-tools/process_csr_batch.sh upload --auto-upload
```

#### 3. è‡ªå‹•ç›£æ§æ¨¡å¼

æŒçºŒç›£æ§ä¸¦è‡ªå‹•è™•ç†æ–°çš„ CSRï¼š

```bash
# å•Ÿå‹•ç›£æ§æ¨¡å¼ï¼ˆæ¯ 30 ç§’æª¢æŸ¥ä¸€æ¬¡ï¼‰
./admin-tools/process_csr_batch.sh monitor -e staging

# è‡ªå®šç¾©æª¢æŸ¥é–“éš”ï¼ˆç§’ï¼‰
./admin-tools/process_csr_batch.sh monitor -e staging -i 60
```

### è­‰æ›¸æ’¤éŠ·

#### æ’¤éŠ·å–®ä¸€ä½¿ç”¨è€…
```bash
./admin-tools/revoke_member_access.sh
```

ç³»çµ±æœƒï¼š
1. åˆ—å‡ºæ‰€æœ‰ä½¿ç”¨è€…ä¾›é¸æ“‡
2. æ’¤éŠ·é¸å®šä½¿ç”¨è€…çš„è­‰æ›¸
3. æ–·é–‹å…¶ç¾æœ‰ VPN é€£ç·š
4. å¾ ACM ç§»é™¤è­‰æ›¸
5. æ›´æ–°æ’¤éŠ·åˆ—è¡¨

#### å“¡å·¥é›¢è·è™•ç†
```bash
./admin-tools/employee_offboarding.sh username
```

å®Œæ•´çš„é›¢è·æµç¨‹åŒ…æ‹¬ï¼š
- æ’¤éŠ·æ‰€æœ‰ç’°å¢ƒçš„ VPN å­˜å–
- ç§»é™¤ IAM æ¬Šé™
- æ¸…ç† S3 è­‰æ›¸æª”æ¡ˆ
- ç”Ÿæˆé›¢è·å ±å‘Š

### CA è­‰æ›¸ç®¡ç†

#### æŸ¥çœ‹ CA è­‰æ›¸ç‹€æ…‹
```bash
# åœ¨ç®¡ç†æ§åˆ¶å°ä¸­é¸æ“‡ã€ŒæŸ¥çœ‹è­‰æ›¸ç‹€æ…‹ã€
./admin-tools/aws_vpn_admin.sh
```

#### å‚™ä»½ CA è­‰æ›¸
```bash
# æ‰‹å‹•å‚™ä»½ CA è­‰æ›¸å’Œç§é‘°
cp -r certs/ca-bundle /secure/backup/location/
```

âš ï¸ **é‡è¦**ï¼šCA ç§é‘°å¿…é ˆé›¢ç·šä¿å­˜åœ¨å®‰å…¨ä½ç½®ï¼

## ä½¿ç”¨è€…æ¬Šé™ç®¡ç†

### IAM æ”¿ç­–æ¶æ§‹

ç³»çµ±ä½¿ç”¨å…©å€‹ä¸»è¦ IAM æ”¿ç­–ï¼š

1. **VPN-CSR-TeamMember-Policy**
   - åŸºæœ¬ S3 å­˜å–æ¬Šé™
   - å¯ä¸Šå‚³ CSRã€ä¸‹è¼‰è­‰æ›¸
   - ç„¡ç®¡ç†æ¬Šé™

2. **VPN-CSR-Admin-Policy**
   - å®Œæ•´ S3 ç®¡ç†æ¬Šé™
   - å¯ç°½ç™¼å’Œç®¡ç†è­‰æ›¸
   - ç³»çµ±ç®¡ç†æ¬Šé™

### æ–°å¢ä½¿ç”¨è€…

#### æ–°å¢å–®ä¸€ä½¿ç”¨è€…
```bash
# æ–°å¢ç¾æœ‰ AWS ä½¿ç”¨è€…
./admin-tools/manage_vpn_users.sh add john.doe

# å‰µå»ºæ–°ä½¿ç”¨è€…ä¸¦åˆ†é…æ¬Šé™
./admin-tools/manage_vpn_users.sh add jane.smith --create-user
```

#### æ‰¹æ¬¡æ–°å¢ä½¿ç”¨è€…

1. å‰µå»ºä½¿ç”¨è€…æ¸…å–®æª”æ¡ˆ `users.txt`ï¼š
```
john.doe
jane.smith
# å¯ä»¥åŒ…å«è¨»è§£
bob.wilson
alice.chen
```

2. åŸ·è¡Œæ‰¹æ¬¡æ–°å¢ï¼š
```bash
./admin-tools/manage_vpn_users.sh batch-add users.txt
```

### æ¬Šé™ç®¡ç†æ“ä½œ

#### æŸ¥çœ‹ä½¿ç”¨è€…æ¸…å–®
```bash
# åˆ—å‡ºæ‰€æœ‰ VPN ä½¿ç”¨è€…
./admin-tools/manage_vpn_users.sh list
```

è¼¸å‡ºç¯„ä¾‹ï¼š
```
=== VPN Users List ===
Environment: staging
AWS Profile: staging-vpn-admin

TeamMember Policy Users (3):
- john.doe
- jane.smith
- bob.wilson

Admin Policy Users (2):
- admin1
- admin2
```

#### æª¢æŸ¥ä½¿ç”¨è€…æ¬Šé™
```bash
# æª¢æŸ¥ç‰¹å®šä½¿ç”¨è€…
./admin-tools/manage_vpn_users.sh status john.doe

# æ¸¬è©¦ä½¿ç”¨è€…çš„ S3 æ¬Šé™
./admin-tools/manage_vpn_users.sh check-permissions john.doe
```

#### ç§»é™¤ä½¿ç”¨è€…æ¬Šé™
```bash
# åªç§»é™¤ VPN æ¬Šé™
./admin-tools/manage_vpn_users.sh remove john.doe

# å®Œå…¨ç§»é™¤ä½¿ç”¨è€…ï¼ˆè¬¹æ…ä½¿ç”¨ï¼‰
./admin-tools/employee_offboarding.sh john.doe
```

### æ–°å¢ç®¡ç†å“¡

ç•¶éœ€è¦æ–°å¢ç®¡ç†å“¡æ™‚ï¼š

1. ç·¨è¼¯ `admin-tools/setup_csr_s3_bucket.sh`ï¼š
```bash
VPN_ADMIN_USERS=(
    "ct"
    "new-admin"  # æ–°å¢ç®¡ç†å“¡
)
```

2. æ›´æ–° S3 æ¡¶æ”¿ç­–ï¼š
```bash
./admin-tools/setup_csr_s3_bucket.sh
```

## VPN ç«¯é»ç®¡ç†

### ç®¡ç†æ§åˆ¶å°

å•Ÿå‹•ç®¡ç†æ§åˆ¶å°ï¼š
```bash
./admin-tools/aws_vpn_admin.sh
```

ä¸»é¸å–®åŠŸèƒ½ï¼š
1. å‰µå»ºæ–°çš„ VPN ç«¯é»
2. æŸ¥çœ‹ç¾æœ‰ VPN ç«¯é»
3. ç®¡ç†åœ˜éšŠæˆå“¡
4. æŸ¥çœ‹è­‰æ›¸ç‹€æ…‹
5. ç”Ÿæˆå®¢æˆ¶ç«¯é…ç½®
6. è¨­å®š AWS Profile
7. åˆªé™¤ VPN ç«¯é»

### å‰µå»º VPN ç«¯é»

é¸æ“‡ã€Œå‰µå»ºæ–°çš„ VPN ç«¯é»ã€å¾Œï¼Œç³»çµ±æœƒï¼š

1. **ç’°å¢ƒç¢ºèª**
   - é¡¯ç¤ºç•¶å‰ç’°å¢ƒï¼ˆStaging/Productionï¼‰
   - Production éœ€è¦å¤šé‡ç¢ºèª

2. **ç¶²è·¯é…ç½®**
   - é¸æ“‡ VPC
   - é¸æ“‡å­ç¶²è·¯
   - è¨­å®šå®¢æˆ¶ç«¯ CIDRï¼ˆé è¨­ï¼š172.16.0.0/22ï¼‰

3. **è­‰æ›¸é…ç½®**
   - è‡ªå‹•ä½¿ç”¨ç’°å¢ƒå°æ‡‰çš„è­‰æ›¸
   - é©—è­‰è­‰æ›¸æœ‰æ•ˆæ€§

4. **å®‰å…¨ç¾¤çµ„**
   - è‡ªå‹•å‰µå»ºå°ˆç”¨å®‰å…¨ç¾¤çµ„
   - é…ç½®åŸºæœ¬å‡ºç«™è¦å‰‡

### ç«¯é»å¥åº·æª¢æŸ¥

```bash
# å…¨é¢åˆ†æ VPN é…ç½®
./admin-tools/run-vpn-analysis.sh staging

# ç”Ÿæˆè©³ç´°å ±å‘Š
./admin-tools/run-vpn-analysis.sh production
```

å ±å‘Šå…§å®¹åŒ…æ‹¬ï¼š
- ç«¯é»ç‹€æ…‹å’Œé…ç½®
- å®‰å…¨ç¾¤çµ„è¦å‰‡åˆ†æ
- æœå‹™å­˜å–æ¬Šé™çŸ©é™£
- æ”¹å–„å»ºè­°

### ä¿®å¾©å¸¸è¦‹å•é¡Œ

#### ç«¯é» ID ä¸åŒ¹é…
```bash
./admin-tools/tools/fix_endpoint_id.sh
```

#### ç¶²éš›ç¶²è·¯å­˜å–å•é¡Œ
```bash
# ä¿®å¾©æ‰€æœ‰ç«¯é»
./admin-tools/tools/fix_internet_access.sh

# ä¿®å¾©ç‰¹å®šç«¯é»
./admin-tools/tools/fix_internet_access.sh cvpn-endpoint-xxxxx
```

#### é…ç½®é©—è­‰å’Œä¿®å¾©
```bash
./admin-tools/tools/validate_config.sh
```

## S3 è­‰æ›¸äº¤æ›ç³»çµ±

### åˆå§‹è¨­ç½®

è¨­ç½® S3 è­‰æ›¸äº¤æ›ç³»çµ±ï¼š

```bash
# åŸºæœ¬è¨­ç½®
./admin-tools/setup_csr_s3_bucket.sh

# è¨­ç½®ä¸¦ç™¼å¸ƒå…¬é–‹è³‡æº
./admin-tools/setup_csr_s3_bucket.sh --publish-assets
```

### S3 æ¡¶çµæ§‹

```
vpn-csr-exchange/
â”œâ”€â”€ public/                 # å…¬é–‹å¯è®€
â”‚   â”œâ”€â”€ ca.crt             # CA è­‰æ›¸
â”‚   â””â”€â”€ vpn_endpoints.json # ç«¯é»é…ç½®
â”œâ”€â”€ csr/                   # ä½¿ç”¨è€…ä¸Šå‚³ CSR
â”‚   â””â”€â”€ {username}.csr
â”œâ”€â”€ cert/                  # ç®¡ç†å“¡ä¸Šå‚³è­‰æ›¸
â”‚   â””â”€â”€ {username}.crt
â””â”€â”€ log/                   # å¯©è¨ˆæ—¥èªŒ
    â””â”€â”€ processed/
```

### æ¬Šé™ç®¡ç†

#### æ›´æ–° IAM æ”¿ç­–
```bash
# åªæ›´æ–°æ”¿ç­–
./admin-tools/setup_csr_s3_bucket.sh --create-policies

# æª¢æŸ¥æ”¿ç­–ç‹€æ…‹
./admin-tools/setup_csr_s3_bucket.sh --list-policies
```

#### ç™¼å¸ƒç«¯é»è³‡è¨Š
```bash
# ç™¼å¸ƒæ‰€æœ‰ç’°å¢ƒ
./admin-tools/publish_endpoints.sh

# ç™¼å¸ƒç‰¹å®šç’°å¢ƒ
./admin-tools/publish_endpoints.sh -e production
```

### ç›£æ§ S3 æ´»å‹•

é€é CloudTrail ç›£æ§ï¼š
- CSR ä¸Šå‚³äº‹ä»¶
- è­‰æ›¸ä¸‹è¼‰äº‹ä»¶
- ç•°å¸¸å­˜å–å˜—è©¦

## Slack ç®¡ç†æŒ‡ä»¤

### ç®¡ç†å“¡å°ˆç”¨æŒ‡ä»¤

#### 1. åœç”¨è‡ªå‹•é—œé–‰ï¼ˆ24å°æ™‚ï¼‰
```
/vpn admin noclose staging
/vpn admin noclose production
```

ç”¨é€”ï¼šç¶­è­·æœŸé–“é˜²æ­¢ VPN è‡ªå‹•é—œé–‰

#### 2. é‡æ–°å•Ÿç”¨è‡ªå‹•é—œé–‰
```
/vpn admin autoclose staging
/vpn admin autoclose production
```

#### 3. æª¢æŸ¥å†·å»ç‹€æ…‹
```
/vpn admin cooldown staging
```

é¡¯ç¤ºå†·å»æœŸå‰©é¤˜æ™‚é–“

#### 4. å¼·åˆ¶é—œé–‰ï¼ˆç¹éä¿è­·ï¼‰
```
/vpn admin force-close staging
```

âš ï¸ è¬¹æ…ä½¿ç”¨ï¼šæœƒç¹éæ‰€æœ‰å®‰å…¨æª¢æŸ¥

### æˆæœ¬ç®¡ç†æŒ‡ä»¤

#### æŸ¥çœ‹ç¯€çœå ±å‘Š
```
/vpn savings staging
/vpn savings production
```

#### æˆæœ¬åˆ†æ
```
/vpn costs daily       # æ¯æ—¥æˆæœ¬ç´°åˆ†
/vpn costs cumulative  # ç´¯ç©æˆæœ¬çµ±è¨ˆ
```

### ç®¡ç†é€šçŸ¥è¨­å®š

Slack é€šçŸ¥åŒ…æ‹¬ï¼š
- VPN é–‹å•Ÿ/é—œé–‰é€šçŸ¥
- è‡ªå‹•å„ªåŒ–é€šçŸ¥
- ç³»çµ±è­¦å ±
- æˆæœ¬å ±å‘Š

## ç›£æ§èˆ‡å ±å‘Š

### CloudWatch ç›£æ§

ç³»çµ±è‡ªå‹•ç™¼é€ä»¥ä¸‹æŒ‡æ¨™ï¼š

1. **æ“ä½œæŒ‡æ¨™**
   - VpnOpenOperations
   - VpnCloseOperations
   - VpnOperationErrors
   - VpnOperationBlocked

2. **æˆæœ¬æŒ‡æ¨™**
   - IdleTimeDetected
   - AutoCloseTriggered
   - CostSaved

3. **ç³»çµ±æŒ‡æ¨™**
   - LambdaErrors
   - CrossAccountRoutingErrors

### æ—¥èªŒåˆ†æ

#### æŸ¥çœ‹ Lambda æ—¥èªŒ
```bash
# æŸ¥çœ‹ slack-handler æ—¥èªŒ
aws logs tail /aws/lambda/vpn-slack-handler-staging --follow

# æŸ¥çœ‹ vpn-monitor æ—¥èªŒ
aws logs tail /aws/lambda/vpn-monitor-production --follow
```

#### é‡è¦æ—¥èªŒæ¨¡å¼
- `ERROR` - ç³»çµ±éŒ¯èª¤
- `WARN` - è­¦å‘Šè¨Šæ¯
- `Cost Optimization` - æˆæœ¬å„ªåŒ–äº‹ä»¶
- `Security Alert` - å®‰å…¨è­¦å ±

### å®šæœŸå ±å‘Š

å»ºè­°å®šæœŸç”Ÿæˆä»¥ä¸‹å ±å‘Šï¼š

1. **é€±å ±**
   - VPN ä½¿ç”¨çµ±è¨ˆ
   - æˆæœ¬ç¯€çœç¸½çµ
   - ç•°å¸¸æ´»å‹•æ‘˜è¦

2. **æœˆå ±**
   - ä½¿ç”¨è€…æ´»å‹•åˆ†æ
   - æˆæœ¬è¶¨å‹¢åœ–è¡¨
   - ç³»çµ±å¥åº·ç‹€æ…‹

## æ•…éšœè™•ç†

### å¸¸è¦‹å•é¡Œè™•ç†

#### 1. Lambda å‡½æ•¸éŒ¯èª¤

**ç—‡ç‹€**ï¼šSlack æŒ‡ä»¤ç„¡å›æ‡‰æˆ–é€¾æ™‚

**è¨ºæ–·æ­¥é©Ÿ**ï¼š
```bash
# æª¢æŸ¥éƒ¨ç½²ç‹€æ…‹
./scripts/deploy.sh status

# æŸ¥çœ‹éŒ¯èª¤æ—¥èªŒ
aws logs tail /aws/lambda/vpn-slack-handler-staging
```

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
```bash
# é‡æ–°éƒ¨ç½²å—å½±éŸ¿çš„ç’°å¢ƒ
./scripts/deploy.sh staging --secure-parameters
```

#### 2. è·¨å¸³æˆ¶è·¯ç”±å¤±æ•—

**ç—‡ç‹€**ï¼šProduction æŒ‡ä»¤å¤±æ•—

**è¨ºæ–·æ­¥é©Ÿ**ï¼š
```bash
# é©—è­‰è·¯ç”±é…ç½®
./scripts/deploy.sh validate-routing
```

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
```bash
# æ›´æ–°è·¯ç”±é…ç½®
./scripts/deploy.sh staging --secure-parameters
```

#### 3. VPN ç«¯é»ç•°å¸¸

**ç—‡ç‹€**ï¼šç„¡æ³•é€£æ¥æˆ–é »ç¹æ–·ç·š

**è¨ºæ–·æ­¥é©Ÿ**ï¼š
```bash
# åŸ·è¡Œå®Œæ•´è¨ºæ–·
./admin-tools/tools/debug_vpn_creation.sh

# åˆ†æç«¯é»é…ç½®
./admin-tools/run-vpn-analysis.sh
```

### ç·Šæ€¥è™•ç†ç¨‹åº

#### 1. å®‰å…¨äº‹ä»¶
1. ç«‹å³åœç”¨å—å½±éŸ¿çš„è­‰æ›¸
2. é€šçŸ¥æ‰€æœ‰ç›¸é—œäººå“¡
3. å¯©æŸ¥å­˜å–æ—¥èªŒ
4. æ›´æ–°å®‰å…¨æ”¿ç­–

#### 2. ç³»çµ±æ•…éšœ
1. åˆ‡æ›åˆ°å‚™ç”¨æ–¹æ¡ˆ
2. æ”¶é›†è¨ºæ–·è³‡è¨Š
3. è¯ç¹« AWS æ”¯æ´
4. æº–å‚™æ•…éšœå ±å‘Š

#### 3. æˆæœ¬ç•°å¸¸
1. æª¢æŸ¥è‡ªå‹•é—œé–‰åŠŸèƒ½
2. å¯©æŸ¥ä½¿ç”¨æ¨¡å¼
3. èª¿æ•´é–’ç½®é–€æª»
4. å¯¦æ–½ä½¿ç”¨æ”¿ç­–

## å®‰å…¨æœ€ä½³å¯¦è¸

### è­‰æ›¸å®‰å…¨

1. **CA ç§é‘°ç®¡ç†**
   - é›¢ç·šå­˜å„²åœ¨åŠ å¯†è£ç½®
   - é™åˆ¶å­˜å–äººå“¡
   - å®šæœŸè¼ªæ›

2. **è­‰æ›¸ç°½ç™¼æµç¨‹**
   - é©—è­‰ç”³è«‹è€…èº«ä»½
   - è¨˜éŒ„æ‰€æœ‰ç°½ç™¼æ´»å‹•
   - è¨­å®šåˆç†æœ‰æ•ˆæœŸ

3. **æ’¤éŠ·ç®¡ç†**
   - åŠæ™‚è™•ç†é›¢è·
   - ç¶­è­·æ’¤éŠ·åˆ—è¡¨
   - å®šæœŸå¯©æŸ¥æ´»èºè­‰æ›¸

### å­˜å–æ§åˆ¶

1. **æœ€å°æ¬Šé™åŸå‰‡**
   - åªæˆäºˆå¿…è¦æ¬Šé™
   - å®šæœŸå¯©æŸ¥æ¬Šé™
   - ç§»é™¤æœªä½¿ç”¨å¸³è™Ÿ

2. **ç’°å¢ƒéš”é›¢**
   - åš´æ ¼åˆ†é›¢ç’°å¢ƒæ¬Šé™
   - ä½¿ç”¨ä¸åŒ AWS å¸³æˆ¶
   - å¯¦æ–½è·¨å¸³æˆ¶é©—è­‰

3. **å¯©è¨ˆè¿½è¹¤**
   - å•Ÿç”¨ CloudTrail
   - ä¿å­˜æ‰€æœ‰æ—¥èªŒ
   - å®šæœŸå¯©æŸ¥æ´»å‹•

### æ“ä½œå®‰å…¨

1. **è®Šæ›´ç®¡ç†**
   - è¨˜éŒ„æ‰€æœ‰è®Šæ›´
   - æ¸¬è©¦å¾Œå†éƒ¨ç½²
   - æº–å‚™å›æ»¾è¨ˆåŠƒ

2. **å‚™ä»½ç­–ç•¥**
   - å®šæœŸå‚™ä»½é…ç½®
   - æ¸¬è©¦æ¢å¾©ç¨‹åº
   - ç•°åœ°å‚™ä»½é‡è¦è³‡æ–™

3. **ç›£æ§å‘Šè­¦**
   - è¨­å®šé—œéµæŒ‡æ¨™å‘Šè­¦
   - åŠæ™‚éŸ¿æ‡‰ç•°å¸¸
   - å®šæœŸæª¢è¨é–¾å€¼

## ç®¡ç†å·¥å…·åƒè€ƒ

### ç’°å¢ƒç®¡ç†å·¥å…·

| å·¥å…· | ç”¨é€” | å¸¸ç”¨é¸é … |
|------|------|----------|
| `vpn_env.sh` | ç’°å¢ƒç®¡ç† | `status`, `switch`, `selector` |
| `enhanced_env_selector.sh` | äº’å‹•å¼é¸æ“‡ | - |

### è­‰æ›¸ç®¡ç†å·¥å…·

| å·¥å…· | ç”¨é€” | å¸¸ç”¨é¸é … |
|------|------|----------|
| `sign_csr.sh` | ç°½ç™¼è­‰æ›¸ | `-e`, `--upload-s3` |
| `process_csr_batch.sh` | æ‰¹æ¬¡è™•ç† | `download`, `process`, `upload`, `monitor` |
| `revoke_member_access.sh` | æ’¤éŠ·è­‰æ›¸ | - |

### ä½¿ç”¨è€…ç®¡ç†å·¥å…·

| å·¥å…· | ç”¨é€” | å¸¸ç”¨é¸é … |
|------|------|----------|
| `manage_vpn_users.sh` | ä½¿ç”¨è€…ç®¡ç† | `list`, `add`, `remove`, `status` |
| `employee_offboarding.sh` | é›¢è·è™•ç† | - |

### è¨ºæ–·ä¿®å¾©å·¥å…·

| å·¥å…· | ç”¨é€” | ä½¿ç”¨æ™‚æ©Ÿ |
|------|------|----------|
| `debug_vpn_creation.sh` | è¨ºæ–·å‰µå»ºå•é¡Œ | VPN å‰µå»ºå¤±æ•— |
| `fix_endpoint_id.sh` | ä¿®å¾©ç«¯é» ID | ID ä¸åŒ¹é…éŒ¯èª¤ |
| `fix_internet_access.sh` | ä¿®å¾©ç¶²è·¯å­˜å– | ç„¡æ³•å­˜å–ç¶²éš›ç¶²è·¯ |
| `validate_config.sh` | é©—è­‰é…ç½® | å®šæœŸæª¢æŸ¥ |

### åˆ†æå ±å‘Šå·¥å…·

| å·¥å…· | ç”¨é€” | è¼¸å‡ºæ ¼å¼ |
|------|------|----------|
| `run-vpn-analysis.sh` | å…¨é¢åˆ†æ | Markdown, JSON |

---

## é™„éŒ„

### å¿«é€Ÿåƒè€ƒå¡

#### æ—¥å¸¸æ“ä½œæµç¨‹
1. æ—©ä¸Šæª¢æŸ¥ç³»çµ±ç‹€æ…‹
2. è™•ç†å¾…ç°½ç™¼çš„è­‰æ›¸
3. æª¢è¦–æˆæœ¬å ±å‘Š
4. è™•ç†ä½¿ç”¨è€…è«‹æ±‚
5. æ™šä¸Šç¢ºèªè‡ªå‹•é—œé–‰æ­£å¸¸

#### ç·Šæ€¥è¯çµ¡
- AWS æ”¯æ´ï¼š[AWS Support Console](https://console.aws.amazon.com/support/)
- å…§éƒ¨æ”¯æ´ï¼šSlack #vpn-emergency
- å€¼ç­é›»è©±ï¼šæŸ¥çœ‹å€¼ç­è¡¨

#### æœ‰ç”¨çš„åˆ¥å
```bash
# åŠ å…¥åˆ° ~/.bashrc æˆ– ~/.zshrc
alias vpn-status='./admin-tools/vpn_env.sh status'
alias vpn-staging='./admin-tools/vpn_env.sh switch staging'
alias vpn-prod='./admin-tools/vpn_env.sh switch production'
alias vpn-admin='./admin-tools/aws_vpn_admin.sh'
```

---

**æ–‡ä»¶ç‰ˆæœ¬**ï¼š1.0  
**æœ€å¾Œæ›´æ–°**ï¼š2025-06-29  
**é©ç”¨ç³»çµ±ç‰ˆæœ¬**ï¼š3.0+